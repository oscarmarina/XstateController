var Ni=Object.defineProperty;var Ci=(s,t,e)=>t in s?Ni(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var Ct=(s,t,e)=>(Ci(s,typeof t!="symbol"?t+"":t,e),e),Pi=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var lt=(s,t,e)=>(Pi(s,t,"read from private field"),e?e.call(s):t.get(s)),we=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Mt=globalThis,ge=Mt.ShadowRoot&&(Mt.ShadyCSS===void 0||Mt.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ve=Symbol(),Ee=new WeakMap;let Ke=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==ve)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(ge&&t===void 0){const i=e!==void 0&&e.length===1;i&&(t=Ee.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&Ee.set(e,t))}return t}toString(){return this.cssText}};const Ii=s=>new Ke(typeof s=="string"?s:s+"",void 0,ve),Li=(s,...t)=>{const e=s.length===1?s[0]:t.reduce((i,n,o)=>i+(r=>{if(r._$cssResult$===!0)return r.cssText;if(typeof r=="number")return r;throw Error("Value passed to 'css' function must be a 'css' function result: "+r+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[o+1],s[0]);return new Ke(e,s,ve)},Ui=(s,t)=>{if(ge)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),n=Mt.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=e.cssText,s.appendChild(i)}},Ae=ge?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return Ii(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Mi,defineProperty:Ri,getOwnPropertyDescriptor:Di,getOwnPropertyNames:Vi,getOwnPropertySymbols:Hi,getPrototypeOf:zi}=Object,V=globalThis,Oe=V.trustedTypes,Bi=Oe?Oe.emptyScript:"",ie=V.reactiveElementPolyfillSupport,bt=(s,t)=>s,ce={toAttribute(s,t){switch(t){case Boolean:s=s?Bi:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},Qe=(s,t)=>!Mi(s,t),je={attribute:!0,type:String,converter:ce,reflect:!1,hasChanged:Qe};var ze,Be;(ze=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(Be=V.litPropertyMetadata)!=null||(V.litPropertyMetadata=new WeakMap);let et=class extends HTMLElement{static addInitializer(t){var e;this._$Ei(),((e=this.l)!=null?e:this.l=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=je){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),n=this.getPropertyDescriptor(t,i,e);n!==void 0&&Ri(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){var r;const{get:n,set:o}=(r=Di(this.prototype,t))!=null?r:{get(){return this[e]},set(c){this[e]=c}};return{get(){return n==null?void 0:n.call(this)},set(c){const a=n==null?void 0:n.call(this);o.call(this,c),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){var e;return(e=this.elementProperties.get(t))!=null?e:je}static _$Ei(){if(this.hasOwnProperty(bt("elementProperties")))return;const t=zi(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(bt("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(bt("properties"))){const e=this.properties,i=[...Vi(e),...Hi(e)];for(const n of i)this.createProperty(n,e[n])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[i,n]of e)this.elementProperties.set(i,n)}this._$Eh=new Map;for(const[e,i]of this.elementProperties){const n=this._$Eu(e,i);n!==void 0&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const n of i)e.unshift(Ae(n))}else t!==void 0&&e.push(Ae(t));return e}static _$Eu(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$Eg=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e,i;((e=this._$ES)!=null?e:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((i=t.hostConnected)==null||i.call(t))}removeController(t){var e;(e=this._$ES)==null||e.splice(this._$ES.indexOf(t)>>>0,1)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){var e;const t=(e=this.shadowRoot)!=null?e:this.attachShadow(this.constructor.shadowRootOptions);return Ui(t,this.constructor.elementStyles),t}connectedCallback(){var t,e;(t=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)==null||e.forEach(i=>{var n;return(n=i.hostConnected)==null?void 0:n.call(i)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EO(t,e){var o;const i=this.constructor.elementProperties.get(t),n=this.constructor._$Eu(t,i);if(n!==void 0&&i.reflect===!0){const r=(((o=i.converter)==null?void 0:o.toAttribute)!==void 0?i.converter:ce).toAttribute(e,i.type);this._$Em=t,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(t,e){var o;const i=this.constructor,n=i._$Eh.get(t);if(n!==void 0&&this._$Em!==n){const r=i.getPropertyOptions(n),c=typeof r.converter=="function"?{fromAttribute:r.converter}:((o=r.converter)==null?void 0:o.fromAttribute)!==void 0?r.converter:ce;this._$Em=n,this[n]=c.fromAttribute(e,r.type),this._$Em=null}}requestUpdate(t,e,i,n=!1,o){var r;if(t!==void 0){if(i!=null||(i=this.constructor.getPropertyOptions(t)),!((r=i.hasChanged)!=null?r:Qe)(n?o:this[t],e))return;this.C(t,e,i)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(t,e,i){var n;this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$Em!==t&&((n=this._$Ej)!=null?n:this._$Ej=new Set).add(t)}async _$EP(){this.isUpdatePending=!0;try{await this._$Eg}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(const[o,r]of this._$Ep)this[o]=r;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[o,r]of n)r.wrapped!==!0||this._$AL.has(o)||this[o]===void 0||this.C(o,this[o],r)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(i=this._$ES)==null||i.forEach(n=>{var o;return(o=n.hostUpdate)==null?void 0:o.call(n)}),this.update(e)):this._$ET()}catch(n){throw t=!1,this._$ET(),n}t&&this._$AE(e)}willUpdate(t){}_$AE(t){var e;(e=this._$ES)==null||e.forEach(i=>{var n;return(n=i.hostUpdated)==null?void 0:n.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EO(e,this[e]))),this._$ET()}updated(t){}firstUpdated(t){}};var qe;et.elementStyles=[],et.shadowRootOptions={mode:"open"},et[bt("elementProperties")]=new Map,et[bt("finalized")]=new Map,ie==null||ie({ReactiveElement:et}),((qe=V.reactiveElementVersions)!=null?qe:V.reactiveElementVersions=[]).push("2.0.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const _t=globalThis,Ht=_t.trustedTypes,ke=Ht?Ht.createPolicy("lit-html",{createHTML:s=>s}):void 0,Xe="$lit$",D=`lit$${(Math.random()+"").slice(9)}$`,Ge="?"+D,qi=`<${Ge}>`,X=document,At=()=>X.createComment(""),Ot=s=>s===null||typeof s!="object"&&typeof s!="function",Ze=Array.isArray,Ji=s=>Ze(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",se=`[ 	
\f\r]`,ut=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Te=/-->/g,Ne=/>/g,q=RegExp(`>|${se}(?:([^\\s"'>=/]+)(${se}*=${se}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Ce=/'/g,Pe=/"/g,Ye=/^(?:script|style|textarea|title)$/i,Fi=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),ti=Fi(1),ot=Symbol.for("lit-noChange"),A=Symbol.for("lit-nothing"),Ie=new WeakMap,F=X.createTreeWalker(X,129);function ei(s,t){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return ke!==void 0?ke.createHTML(t):t}const Wi=(s,t)=>{const e=s.length-1,i=[];let n,o=t===2?"<svg>":"",r=ut;for(let c=0;c<e;c++){const a=s[c];let h,d,l=-1,g=0;for(;g<a.length&&(r.lastIndex=g,d=r.exec(a),d!==null);)g=r.lastIndex,r===ut?d[1]==="!--"?r=Te:d[1]!==void 0?r=Ne:d[2]!==void 0?(Ye.test(d[2])&&(n=RegExp("</"+d[2],"g")),r=q):d[3]!==void 0&&(r=q):r===q?d[0]===">"?(r=n!=null?n:ut,l=-1):d[1]===void 0?l=-2:(l=r.lastIndex-d[2].length,h=d[1],r=d[3]===void 0?q:d[3]==='"'?Pe:Ce):r===Pe||r===Ce?r=q:r===Te||r===Ne?r=ut:(r=q,n=void 0);const p=r===q&&s[c+1].startsWith("/>")?" ":"";o+=r===ut?a+qi:l>=0?(i.push(h),a.slice(0,l)+Xe+a.slice(l)+D+p):a+D+(l===-2?c:p)}return[ei(s,o+(s[e]||"<?>")+(t===2?"</svg>":"")),i]};let he=class ii{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let o=0,r=0;const c=t.length-1,a=this.parts,[h,d]=Wi(t,e);if(this.el=ii.createElement(h,i),F.currentNode=this.el.content,e===2){const l=this.el.content.firstChild;l.replaceWith(...l.childNodes)}for(;(n=F.nextNode())!==null&&a.length<c;){if(n.nodeType===1){if(n.hasAttributes())for(const l of n.getAttributeNames())if(l.endsWith(Xe)){const g=d[r++],p=n.getAttribute(l).split(D),m=/([.?@])?(.*)/.exec(g);a.push({type:1,index:o,name:m[2],strings:p,ctor:m[1]==="."?Qi:m[1]==="?"?Xi:m[1]==="@"?Gi:Qt}),n.removeAttribute(l)}else l.startsWith(D)&&(a.push({type:6,index:o}),n.removeAttribute(l));if(Ye.test(n.tagName)){const l=n.textContent.split(D),g=l.length-1;if(g>0){n.textContent=Ht?Ht.emptyScript:"";for(let p=0;p<g;p++)n.append(l[p],At()),F.nextNode(),a.push({type:2,index:++o});n.append(l[g],At())}}}else if(n.nodeType===8)if(n.data===Ge)a.push({type:2,index:o});else{let l=-1;for(;(l=n.data.indexOf(D,l+1))!==-1;)a.push({type:7,index:o}),l+=D.length-1}o++}}static createElement(t,e){const i=X.createElement("template");return i.innerHTML=t,i}};function rt(s,t,e=s,i){var r,c,a;if(t===ot)return t;let n=i!==void 0?(r=e._$Co)==null?void 0:r[i]:e._$Cl;const o=Ot(t)?void 0:t._$litDirective$;return(n==null?void 0:n.constructor)!==o&&((c=n==null?void 0:n._$AO)==null||c.call(n,!1),o===void 0?n=void 0:(n=new o(s),n._$AT(s,e,i)),i!==void 0?((a=e._$Co)!=null?a:e._$Co=[])[i]=n:e._$Cl=n),n!==void 0&&(t=rt(s,n._$AS(s,t.values),n,i)),t}let Ki=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var h;const{el:{content:e},parts:i}=this._$AD,n=((h=t==null?void 0:t.creationScope)!=null?h:X).importNode(e,!0);F.currentNode=n;let o=F.nextNode(),r=0,c=0,a=i[0];for(;a!==void 0;){if(r===a.index){let d;a.type===2?d=new ye(o,o.nextSibling,this,t):a.type===1?d=new a.ctor(o,a.name,a.strings,this,t):a.type===6&&(d=new Zi(o,this,t)),this._$AV.push(d),a=i[++c]}r!==(a==null?void 0:a.index)&&(o=F.nextNode(),r++)}return F.currentNode=X,n}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}},ye=class si{get _$AU(){var t,e;return(e=(t=this._$AM)==null?void 0:t._$AU)!=null?e:this._$Cv}constructor(t,e,i,n){var o;this.type=2,this._$AH=A,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=(o=n==null?void 0:n.isConnected)!=null?o:!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=rt(this,t,e),Ot(t)?t===A||t==null||t===""?(this._$AH!==A&&this._$AR(),this._$AH=A):t!==this._$AH&&t!==ot&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):Ji(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==A&&Ot(this._$AH)?this._$AA.nextSibling.data=t:this.$(X.createTextNode(t)),this._$AH=t}g(t){var o;const{values:e,_$litType$:i}=t,n=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=he.createElement(ei(i.h,i.h[0]),this.options)),i);if(((o=this._$AH)==null?void 0:o._$AD)===n)this._$AH.p(e);else{const r=new Ki(n,this),c=r.u(this.options);r.p(e),this.$(c),this._$AH=r}}_$AC(t){let e=Ie.get(t.strings);return e===void 0&&Ie.set(t.strings,e=new he(t)),e}T(t){Ze(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const o of t)n===e.length?e.push(i=new si(this.k(At()),this.k(At()),this,this.options)):i=e[n],i._$AI(o),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}},Qt=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,o){this.type=1,this._$AH=A,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=o,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=A}_$AI(t,e=this,i,n){const o=this.strings;let r=!1;if(o===void 0)t=rt(this,t,e,0),r=!Ot(t)||t!==this._$AH&&t!==ot,r&&(this._$AH=t);else{const c=t;let a,h;for(t=o[0],a=0;a<o.length-1;a++)h=rt(this,c[i+a],e,a),h===ot&&(h=this._$AH[a]),r||(r=!Ot(h)||h!==this._$AH[a]),h===A?t=A:t!==A&&(t+=(h!=null?h:"")+o[a+1]),this._$AH[a]=h}r&&!n&&this.O(t)}O(t){t===A?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t!=null?t:"")}},Qi=class extends Qt{constructor(){super(...arguments),this.type=3}O(t){this.element[this.name]=t===A?void 0:t}},Xi=class extends Qt{constructor(){super(...arguments),this.type=4}O(t){this.element.toggleAttribute(this.name,!!t&&t!==A)}},Gi=class extends Qt{constructor(t,e,i,n,o){super(t,e,i,n,o),this.type=5}_$AI(t,e=this){var r;if((t=(r=rt(this,t,e,0))!=null?r:A)===ot)return;const i=this._$AH,n=t===A&&i!==A||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,o=t!==A&&(i===A||n);n&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;typeof this._$AH=="function"?this._$AH.call((i=(e=this.options)==null?void 0:e.host)!=null?i:this.element,t):this._$AH.handleEvent(t)}},Zi=class{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){rt(this,t)}};const ne=_t.litHtmlPolyfillSupport;var Je;ne==null||ne(he,ye),((Je=_t.litHtmlVersions)!=null?Je:_t.litHtmlVersions=[]).push("3.1.0");const ni=(s,t,e)=>{var o,r;const i=(o=e==null?void 0:e.renderBefore)!=null?o:t;let n=i._$litPart$;if(n===void 0){const c=(r=e==null?void 0:e.renderBefore)!=null?r:null;i._$litPart$=n=new ye(t.insertBefore(At(),c),c,void 0,e!=null?e:{})}return n._$AI(s),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let $t=class extends et{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,i;const t=super.createRenderRoot();return(i=(e=this.renderOptions).renderBefore)!=null||(e.renderBefore=t.firstChild),t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=ni(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return ot}};var Fe;$t._$litElement$=!0,$t.finalized=!0,(Fe=globalThis.litElementHydrateSupport)==null||Fe.call(globalThis,{LitElement:$t});const oe=globalThis.litElementPolyfillSupport;oe==null||oe({LitElement:$t});var We;((We=globalThis.litElementVersions)!=null?We:globalThis.litElementVersions=[]).push("4.0.1");var _,H;(function(s){s.Start="xstate.start",s.Stop="xstate.stop",s.Raise="xstate.raise",s.Send="xstate.send",s.Cancel="xstate.cancel",s.NullEvent="",s.Assign="xstate.assign",s.After="xstate.after",s.DoneState="done.state",s.DoneInvoke="done.invoke",s.Log="xstate.log",s.Init="xstate.init",s.Invoke="xstate.invoke",s.ErrorExecution="error.execution",s.ErrorCommunication="error.communication",s.ErrorPlatform="error.platform",s.ErrorCustom="xstate.error",s.Update="xstate.update",s.Pure="xstate.pure",s.Choose="xstate.choose"})(_||(_={})),function(s){s.Parent="#_parent",s.Internal="#_internal"}(H||(H={}));const zt=_.Start,Xt=_.Stop,ht=_.Raise,Tt=_.Send,me=_.Cancel,oi=_.NullEvent,Bt=_.Assign,Yi=_.After,ts=_.DoneState,Gt=_.Log,ri=_.Init,qt=_.Invoke,es=_.ErrorExecution,de=_.ErrorPlatform,be=_.ErrorCustom,Zt=_.Update,ai=_.Choose,ci=_.Pure;var is=Object.freeze({__proto__:null,start:zt,stop:Xt,raise:ht,send:Tt,cancel:me,nullEvent:oi,assign:Bt,after:Yi,doneState:ts,log:Gt,init:ri,invoke:qt,errorExecution:es,errorPlatform:de,error:be,update:Zt,choose:ai,pure:ci});const Le={};function _e(s,t,e="."){const i=St(s,e),n=St(t,e);return b(n)?!!b(i)&&n===i:b(i)?i in n:Object.keys(i).every(o=>o in n&&_e(i[o],n[o]))}function hi(s){try{return b(s)||typeof s=="number"?""+s:s.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function le(s,t){try{return dt(s)?s:s.toString().split(t)}catch{throw new Error(`'${s}' is not a valid state path.`)}}function St(s,t){if(typeof(e=s)=="object"&&"value"in e&&"context"in e&&"event"in e&&"_event"in e)return s.value;var e;return dt(s)?Jt(s):typeof s!="string"?s:Jt(le(s,t))}function Jt(s){if(s.length===1)return s[0];const t={};let e=t;for(let i=0;i<s.length-1;i++)i===s.length-2?e[s[i]]=s[i+1]:(e[s[i]]={},e=e[s[i]]);return t}function ft(s,t){const e={},i=Object.keys(s);for(let n=0;n<i.length;n++){const o=i[n];e[o]=t(s[o],o,s,n)}return e}function Ue(s,t,e){const i={};for(const n of Object.keys(s)){const o=s[n];e(o)&&(i[n]=t(o,n,s))}return i}const ss=s=>t=>{let e=t;for(const i of s)e=e[i];return e};function Rt(s){return s?b(s)?[[s]]:S(Object.keys(s).map(t=>{const e=s[t];return typeof e=="string"||e&&Object.keys(e).length?Rt(s[t]).map(i=>[t].concat(i)):[[t]]})):[[]]}function S(s){return[].concat(...s)}function di(s){return dt(s)?s:[s]}function P(s){return s===void 0?[]:di(s)}function Ft(s,t,e){if(y(s))return s(t,e.data);const i={};for(const n of Object.keys(s)){const o=s[n];y(o)?i[n]=o(t,e.data):i[n]=o}return i}function Me(s){return s instanceof Promise||!(s===null||!y(s)&&typeof s!="object"||!y(s.then))}function li(s,t){return ft(s.states,(e,i)=>{if(!e)return;const n=(b(t)?void 0:t[i])||(e?e.current:void 0);return n?{current:n,states:li(e,n)}:void 0})}function Re(s,t,e,i){return s&&e.reduce((n,o)=>{const{assignment:r}=o,c={state:i,action:o,_event:t};let a={};if(y(r))a=r(n,t.data,c);else for(const h of Object.keys(r)){const d=r[h];a[h]=y(d)?d(n,t.data,c):d}return Object.assign({},n,a)},s)}function dt(s){return Array.isArray(s)}function y(s){return typeof s=="function"}function b(s){return typeof s=="string"}function ui(s,t){if(s)return b(s)?{type:"xstate.guard",name:s,predicate:t?t[s]:void 0}:y(s)?{type:"xstate.guard",name:s.name,predicate:s}:s}const J=(()=>typeof Symbol=="function"&&Symbol.observable||"@@observable")();function at(s){return!!s&&"__xstatenode"in s}function Yt(s,t){return b(s)||typeof s=="number"?Object.assign({type:s},t):s}function O(s,t){if(!b(s)&&"$$type"in s&&s.$$type==="scxml")return s;const e=Yt(s);return Object.assign({name:e.type,data:e,$$type:"scxml",type:"external"},t)}function Z(s,t){return di(t).map(e=>e===void 0||typeof e=="string"||at(e)?{target:e,event:s}:Object.assign(Object.assign({},e),{event:s}))}function pi(s,t,e,i,n){const{guards:o}=s.options,r={state:n,cond:t,_event:i};if(t.type==="xstate.guard")return((o==null?void 0:o[t.name])||t.predicate)(e,i.data,r);const c=o==null?void 0:o[t.type];if(!c)throw new Error(`Guard '${t.type}' is not implemented on machine '${s.id}'.`);return c(e,i.data,r)}function fi(s){return typeof s=="string"?{type:s}:s}function Dt(s,t,e){const i=()=>{},n=typeof s=="object",o=n?s:null;return{next:((n?s.next:s)||i).bind(o),error:((n?s.error:t)||i).bind(o),complete:((n?s.complete:e)||i).bind(o)}}function Pt(s,t){return`${s}:invocation[${t}]`}function ue(s){return(s.type===ht||s.type===Tt&&s.to===H.Internal)&&typeof s.delay!="number"}const K=O({type:ri});function Wt(s,t){return t&&t[s]||void 0}function ct(s,t){let e;if(b(s)||typeof s=="number"){const i=Wt(s,t);e=y(i)?{type:s,exec:i}:i||{type:s,exec:void 0}}else if(y(s))e={type:s.name||s.toString(),exec:s};else{const i=Wt(s.type,t);if(y(i))e=Object.assign(Object.assign({},s),{exec:i});else if(i){const n=i.type||s.type;e=Object.assign(Object.assign(Object.assign({},i),s),{type:n})}else e=s}return e}const I=(s,t)=>s?(dt(s)?s:[s]).map(e=>ct(e,t)):[];function te(s){const t=ct(s);return Object.assign(Object.assign({id:b(s)?s:t.id},t),{type:t.type})}function gi(s,t){return{type:ht,event:typeof s=="function"?s:Yt(s),delay:t?t.delay:void 0,id:t==null?void 0:t.id}}function vi(s,t,e,i){const n={_event:e},o=O(y(s.event)?s.event(t,e.data,n):s.event);let r;if(b(s.delay)){const c=i&&i[s.delay];r=y(c)?c(t,e.data,n):c}else r=y(s.delay)?s.delay(t,e.data,n):s.delay;return Object.assign(Object.assign({},s),{type:ht,_event:o,delay:r})}function st(s,t){return{to:t?t.to:void 0,type:Tt,event:y(s)?s:Yt(s),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:y(s)?s.name:hi(s)}}function yi(s,t,e,i){const n={_event:e},o=O(y(s.event)?s.event(t,e.data,n):s.event);let r;if(b(s.delay)){const a=i&&i[s.delay];r=y(a)?a(t,e.data,n):a}else r=y(s.delay)?s.delay(t,e.data,n):s.delay;const c=y(s.to)?s.to(t,e.data,n):s.to;return Object.assign(Object.assign({},s),{to:c,_event:o,event:o.data,delay:r})}function re(s,t){return st(s,Object.assign(Object.assign({},t),{to:H.Parent}))}const ns=(s,t)=>({context:s,event:t}),mi=(s,t,e)=>Object.assign(Object.assign({},s),{value:b(s.expr)?s.expr:s.expr(t,e.data,{_event:e})}),bi=s=>({type:me,sendId:s});function _i(s){const t=te(s);return{type:_.Start,activity:t,exec:void 0}}function $i(s){const t=y(s)?s:te(s);return{type:_.Stop,activity:t,exec:void 0}}function Si(s,t,e){const i=y(s.activity)?s.activity(t,e.data):s.activity,n=typeof i=="string"?{id:i}:i;return{type:_.Stop,activity:n}}function xi(s,t){const e=t?"#"+t:"";return`${_.After}(${s})${e}`}function gt(s,t){const e=`${_.DoneState}.${s}`;return{type:e,data:t,toString:()=>e}}function xt(s,t){const e=`${_.DoneInvoke}.${s}`;return{type:e,data:t,toString:()=>e}}function nt(s,t){const e=`${_.ErrorPlatform}.${s}`;return{type:e,data:t,toString:()=>e}}function jt(s,t,e,i,n,o,r=!1){const c=r?[]:(g=>{const p=[];for(const m of g){let u=0;for(;u<m.actions.length;)m.actions[u].type!==Bt?u++:(p.push(m.actions[u]),m.actions.splice(u,1))}return p})(n);let a=c.length?Re(e,i,c,t):e;const h=r?[e]:void 0,d=[];function l(g,p){var m;switch(p.type){case ht:{const f=vi(p,a,i,s.options.delays);return o&&typeof f.delay=="number"&&o(f,a,i),f}case Tt:const u=yi(p,a,i,s.options.delays);return o&&u.to!==H.Internal&&(g==="entry"?d.push(u):o(u,a,i)),u;case Gt:{const f=mi(p,a,i);return o==null||o(f,a,i),f}case ai:{const f=(m=p.conds.find(z=>{const L=ui(z.cond,s.options.guards);return!L||pi(s,L,a,i,o?void 0:t)}))===null||m===void 0?void 0:m.actions;if(!f)return[];const[T,N]=jt(s,t,a,i,[{type:g,actions:I(P(f),s.options.actions)}],o,r);return a=N,h==null||h.push(a),T}case ci:{const f=p.get(a,i.data);if(!f)return[];const[T,N]=jt(s,t,a,i,[{type:g,actions:I(P(f),s.options.actions)}],o,r);return a=N,h==null||h.push(a),T}case Xt:{const f=Si(p,a,i);return o==null||o(f,e,i),f}case Bt:a=Re(a,i,[p],o?void 0:t),h==null||h.push(a);break;default:let v=ct(p,s.options.actions);const{exec:x}=v;if(o)o(v,a,i);else if(x&&h){const f=h.length-1;v=Object.assign(Object.assign({},v),{exec:(T,...N)=>{x(h[f],...N)}})}return v}}return[S(n.map(function(g){let p=[];for(const m of g.actions){const u=l(g.type,m);u&&(p=p.concat(u))}return d.forEach(m=>{o(m,a,i)}),d.length=0,p})),a]}var os=Object.freeze({__proto__:null,actionTypes:is,initEvent:K,getActionFunction:Wt,toActionObject:ct,toActionObjects:I,toActivityDefinition:te,raise:gi,resolveRaise:vi,send:st,resolveSend:yi,sendParent:re,sendTo:function(s,t,e){return st(t,Object.assign(Object.assign({},e),{to:s}))},sendUpdate:function(){return re(Zt)},respond:function(s,t){return st(s,Object.assign(Object.assign({},t),{to:(e,i,{_event:n})=>n.origin}))},log:function(s=ns,t){return{type:Gt,label:t,expr:s}},resolveLog:mi,cancel:bi,start:_i,stop:$i,resolveStop:Si,assign:s=>({type:Bt,assignment:s}),isActionObject:function(s){return typeof s=="object"&&"type"in s},after:xi,done:gt,doneInvoke:xt,error:nt,pure:function(s){return{type:_.Pure,get:s}},forwardTo:function(s,t){return st((e,i)=>i,Object.assign(Object.assign({},t),{to:s}))},escalate:function(s,t){return re((e,i,n)=>({type:be,data:y(s)?s(e,i,n):s}),Object.assign(Object.assign({},t),{to:H.Parent}))},choose:function(s){return{type:_.Choose,conds:s}},resolveActions:jt});const it=(s,t)=>t(s);function wi(s){return{id:s,send:()=>{},subscribe:()=>({unsubscribe:()=>{}}),getSnapshot:()=>{},toJSON:()=>({id:s}),[J]:function(){return this}}}function Ei(s,t,e){const i=wi(t);if(i.deferred=!0,at(s)){const n=i.state=it(void 0,()=>(e?s.withContext(e):s).initialState);i.getSnapshot=()=>n}return i}function rs(s){return Object.assign({subscribe:()=>({unsubscribe:()=>{}}),id:"anonymous",getSnapshot:()=>{},[J]:function(){return this}},s)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function $e(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(i=Object.getOwnPropertySymbols(s);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(s,i[n])&&(e[i[n]]=s[i[n]])}return e}const Kt=s=>s.type==="atomic"||s.type==="final";function Ai(s){return Object.keys(s.states).map(t=>s.states[t])}function kt(s){return Ai(s).filter(t=>t.type!=="history")}function Oi(s){const t=[s];return Kt(s)?t:t.concat(S(kt(s).map(Oi)))}function vt(s,t){const e=pe(new Set(s)),i=new Set(t);for(const o of i){let r=o.parent;for(;r&&!i.has(r);)i.add(r),r=r.parent}const n=pe(i);for(const o of i)if(o.type!=="compound"||n.get(o)&&n.get(o).length){if(o.type==="parallel")for(const r of kt(o))i.has(r)||(i.add(r),e.get(r)?e.get(r).forEach(c=>i.add(c)):r.initialStateNodes.forEach(c=>i.add(c)))}else e.get(o)?e.get(o).forEach(r=>i.add(r)):o.initialStateNodes.forEach(r=>i.add(r));for(const o of i){let r=o.parent;for(;r&&!i.has(r);)i.add(r),r=r.parent}return i}function pe(s){const t=new Map;for(const e of s)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function as(s,t){return function e(i,n){const o=n.get(i);if(!o)return{};if(i.type==="compound"){const c=o[0];if(!c)return{};if(Kt(c))return c.key}const r={};return o.forEach(c=>{r[c.key]=e(c,n)}),r}(s,pe(vt([s],t)))}function yt(s,t){return Array.isArray(s)?s.some(e=>e===t):s instanceof Set&&s.has(t)}function Vt(s,t){return t.type==="compound"?kt(t).some(e=>e.type==="final"&&yt(s,e)):t.type==="parallel"&&kt(t).every(e=>Vt(s,e))}function De(s){return new Set(S(s.map(t=>t.tags)))}function cs(s,t){const{exec:e}=s;return Object.assign(Object.assign({},s),{exec:e!==void 0?()=>e(t.context,t.event,{action:s,state:t,_event:t._event}):void 0})}class E{constructor(t){var e;this.actions=[],this.activities=Le,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||Le,this.meta=function(i=[]){return i.reduce((n,o)=>(o.meta!==void 0&&(n[o.id]=o.meta),n),{})}(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(e=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&e!==void 0?e:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:()=>{return i=this.configuration,[...new Set(S([...i.map(n=>n.ownEvents)]))];var i}})}static from(t,e){return t instanceof E?t.context!==e?new E({value:t.value,context:e,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t:new E({value:t,context:e,_event:K,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})}static create(t){return new E(t)}static inert(t,e){if(t instanceof E){if(!t.actions.length)return t;const i=K;return new E({value:t.value,context:e,_event:i,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return E.from(t,e)}toStrings(t=this.value,e="."){if(b(t))return[t];const i=Object.keys(t);return i.concat(...i.map(n=>this.toStrings(t[n],e).map(o=>n+e+o)))}toJSON(){const{configuration:t,transitions:e,tags:i,machine:n}=this,o=$e(this,["configuration","transitions","tags","machine"]);return Object.assign(Object.assign({},o),{tags:Array.from(i)})}matches(t){return _e(t,this.value)}hasTag(t){return this.tags.has(t)}can(t){var e;this.machine;const i=(e=this.machine)===null||e===void 0?void 0:e.getTransitionData(this,t);return!!(i!=null&&i.transitions.length)&&i.transitions.some(n=>n.target!==void 0||n.actions.length)}}const hs={deferEvents:!1};class Ve{constructor(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=Object.assign(Object.assign({},hs),t)}initialize(t){if(this.initialized=!0,t){if(!this.options.deferEvents)return void this.schedule(t);this.process(t)}this.flushEvents()}schedule(t){if(this.initialized&&!this.processingEvent){if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()}else this.queue.push(t)}clear(){this.queue=[]}flushEvents(){let t=this.queue.shift();for(;t;)this.process(t),t=this.queue.shift()}process(t){this.processingEvent=!0;try{t()}catch(e){throw this.clear(),e}finally{this.processingEvent=!1}}}const ae=new Map;let ds=0;const pt={bookId:()=>"x:"+ds++,register:(s,t)=>(ae.set(s,t),s),get:s=>ae.get(s),free(s){ae.delete(s)}};function fe(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:void 0}function ls(s){if(!fe())return;const t=function(){const e=fe();if(e&&"__xstate__"in e)return e.__xstate__}();t&&t.register(s)}function us(s,t={}){let e=s.initialState;const i=new Set,n=[];let o=!1;const r=rs({id:t.id,send:a=>{n.push(a),(()=>{if(!o){for(o=!0;n.length>0;){const h=n.shift();e=s.transition(e,h,c),i.forEach(d=>d.next(e))}o=!1}})()},getSnapshot:()=>e,subscribe:(a,h,d)=>{const l=Dt(a,h,d);return i.add(l),l.next(e),{unsubscribe:()=>{i.delete(l)}}}}),c={parent:t.parent,self:r,id:t.id||"anonymous",observers:i};return e=s.start?s.start(c):e,r}const ps={sync:!1,autoForward:!1};var w;(function(s){s[s.NotStarted=0]="NotStarted",s[s.Running=1]="Running",s[s.Stopped=2]="Stopped"})(w||(w={}));class Q{constructor(t,e=Q.defaultOptions){this.machine=t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=w.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=(h,d)=>{if(dt(h))return this.batch(h),this.state;const l=O(Yt(h,d));if(this.status===w.Stopped)return this.state;if(this.status!==w.Running&&!this.options.deferEvents)throw new Error(`Event "${l.name}" was sent to uninitialized service "${this.machine.id}". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: ${JSON.stringify(l.data)}`);return this.scheduler.schedule(()=>{this.forward(l);const g=this._nextState(l);this.update(g,l)}),this._state},this.sendTo=(h,d,l)=>{const g=this.parent&&(d===H.Parent||this.parent.id===d),p=g?this.parent:b(d)?d===H.Internal?this:this.children.get(d)||pt.get(d):(m=d)&&typeof m.send=="function"?d:void 0;var m;if(p)if("machine"in p){if(this.status!==w.Stopped||this.parent!==p||this.state.done){const u=Object.assign(Object.assign({},h),{name:h.name===be?""+nt(this.id):h.name,origin:this.sessionId});!l&&this.machine.config.predictableActionArguments?this._outgoingQueue.push([p,u]):p.send(u)}}else!l&&this.machine.config.predictableActionArguments?this._outgoingQueue.push([p,h.data]):p.send(h.data);else if(!g)throw new Error(`Unable to send event to child '${d}' from service '${this.id}'.`)},this._exec=(h,d,l,g=this.machine.options.actions)=>{const p=h.exec||Wt(h.type,g),m=y(p)?p:p?p.exec:h.exec;if(m)try{return m(d,l.data,this.machine.config.predictableActionArguments?{action:h,_event:l}:{action:h,state:this.state,_event:l})}catch(u){throw this.parent&&this.parent.send({type:"xstate.error",data:u}),u}switch(h.type){case ht:{const f=h;this.defer(f);break}case Tt:const u=h;if(typeof u.delay=="number")return void this.defer(u);u.to?this.sendTo(u._event,u.to,l===K):this.send(u._event);break;case me:this.cancel(h.sendId);break;case zt:{if(this.status!==w.Running)return;const f=h.activity;if(!this.machine.config.predictableActionArguments&&!this.state.activities[f.id||f.type])break;if(f.type===_.Invoke){const T=fi(f.src),N=this.machine.options.services?this.machine.options.services[T.type]:void 0,{id:z,data:L}=f,U="autoForward"in f?f.autoForward:!!f.forward;if(!N)return;const G=L?Ft(L,d,l):void 0;if(typeof N=="string")return;let C,M=y(N)?N(d,l.data,{data:G,src:T,meta:f.meta}):N;if(!M)return;at(M)&&(M=G?M.withContext(G):M,C={autoForward:U}),this.spawn(M,z,C)}else this.spawnActivity(f);break}case Xt:this.stopChild(h.activity.id);break;case Gt:const{label:v,value:x}=h;v?this.logger(v,x):this.logger(x)}};const i=Object.assign(Object.assign({},Q.defaultOptions),e),{clock:n,logger:o,parent:r,id:c}=i,a=c!==void 0?c:t.id;this.id=a,this.logger=o,this.clock=n,this.parent=r,this.options=i,this.scheduler=new Ve({deferEvents:this.options.deferEvents}),this.sessionId=pt.bookId()}get initialState(){return this._initialState?this._initialState:it(this,()=>(this._initialState=this.machine.initialState,this._initialState))}get state(){return this._state}execute(t,e){for(const i of t.actions)this.exec(i,t,e)}update(t,e){if(t._sessionid=this.sessionId,this._state=t,this.machine.config.predictableActionArguments&&e!==K||!this.options.execute){let i;for(;i=this._outgoingQueue.shift();)i[0].send(i[1])}else this.execute(this.state);if(this.children.forEach(i=>{this.state.children[i.id]=i}),this.devTools&&this.devTools.send(e.data,t),t.event)for(const i of this.eventListeners)i(t.event);for(const i of this.listeners)i(t,t.event);for(const i of this.contextListeners)i(this.state.context,this.state.history?this.state.history.context:void 0);if(this.state.done){const i=t.configuration.find(o=>o.type==="final"&&o.parent===this.machine),n=i&&i.doneData?Ft(i.doneData,t.context,e):void 0;this._doneEvent=xt(this.id,n);for(const o of this.doneListeners)o(this._doneEvent);this._stop(),this._stopChildren(),pt.free(this.sessionId)}}onTransition(t){return this.listeners.add(t),this.status===w.Running&&t(this.state,this.state.event),this}subscribe(t,e,i){const n=Dt(t,e,i);this.listeners.add(n.next),this.status!==w.NotStarted&&n.next(this.state);const o=()=>{this.doneListeners.delete(o),this.stopListeners.delete(o),n.complete()};return this.status===w.Stopped?n.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:()=>{this.listeners.delete(n.next),this.doneListeners.delete(o),this.stopListeners.delete(o)}}}onEvent(t){return this.eventListeners.add(t),this}onSend(t){return this.sendListeners.add(t),this}onChange(t){return this.contextListeners.add(t),this}onStop(t){return this.stopListeners.add(t),this}onDone(t){return this.status===w.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this}off(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this}start(t){if(this.status===w.Running)return this;this.machine._init(),pt.register(this.sessionId,this),this.initialized=!0,this.status=w.Running;const e=t===void 0?this.initialState:it(this,()=>{return typeof(i=t)=="object"&&i!==null&&"value"in i&&"_event"in i?this.machine.resolveState(t):this.machine.resolveState(E.from(t,this.machine.context));var i});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(()=>{this.update(e,K)}),this}_stopChildren(){this.children.forEach(t=>{y(t.stop)&&t.stop()}),this.children.clear()}_stop(){for(const t of this.listeners)this.listeners.delete(t);for(const t of this.stopListeners)t(),this.stopListeners.delete(t);for(const t of this.contextListeners)this.contextListeners.delete(t);for(const t of this.doneListeners)this.doneListeners.delete(t);if(!this.initialized)return this;this.initialized=!1,this.status=w.Stopped,this._initialState=void 0;for(const t of Object.keys(this.delayedEventsMap))this.clock.clearTimeout(this.delayedEventsMap[t]);this.scheduler.clear(),this.scheduler=new Ve({deferEvents:this.options.deferEvents})}stop(){const t=this.scheduler;return this._stop(),t.schedule(()=>{var e;if(!((e=this._state)===null||e===void 0)&&e.done)return;const i=O({type:"xstate.stop"}),n=it(this,()=>{const o=S([...this.state.configuration].sort((h,d)=>d.order-h.order).map(h=>I(h.onExit,this.machine.options.actions))),[r,c]=jt(this.machine,this.state,this.state.context,i,[{type:"exit",actions:o}],this.machine.config.predictableActionArguments?this._exec:void 0,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),a=new E({value:this.state.value,context:c,_event:i,_sessionid:this.sessionId,historyValue:void 0,history:this.state,actions:r.filter(h=>!ue(h)),activities:{},events:[],configuration:[],transitions:[],children:{},done:this.state.done,tags:this.state.tags,machine:this.machine});return a.changed=!0,a});this.update(n,i),this._stopChildren(),pt.free(this.sessionId)}),this}batch(t){if(!(this.status===w.NotStarted&&this.options.deferEvents)){if(this.status!==w.Running)throw new Error(`${t.length} event(s) were sent to uninitialized service "${this.machine.id}". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.`)}if(!t.length)return;const e=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(()=>{let i=this.state,n=!1;const o=[];for(const r of t){const c=O(r);this.forward(c),i=it(this,()=>this.machine.transition(i,c,void 0,e||void 0)),o.push(...this.machine.config.predictableActionArguments?i.actions:i.actions.map(a=>cs(a,i))),n=n||!!i.changed}i.changed=n,i.actions=o,this.update(i,O(t[t.length-1]))})}sender(t){return this.send.bind(this,t)}_nextState(t,e=!!this.machine.config.predictableActionArguments&&this._exec){const i=O(t);if(i.name.indexOf(de)===0&&!this.state.nextEvents.some(n=>n.indexOf(de)===0))throw i.data.data;return it(this,()=>this.machine.transition(this.state,i,void 0,e||void 0))}nextState(t){return this._nextState(t,!1)}forward(t){for(const e of this.forwardTo){const i=this.children.get(e);if(!i)throw new Error(`Unable to forward event '${t}' from interpreter '${this.id}' to nonexistant child '${e}'.`);i.send(t)}}defer(t){const e=this.clock.setTimeout(()=>{"to"in t&&t.to?this.sendTo(t._event,t.to,!0):this.send(t._event)},t.delay);t.id&&(this.delayedEventsMap[t.id]=e)}cancel(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]}exec(t,e,i=this.machine.options.actions){this._exec(t,e.context,e._event,i)}removeChild(t){var e;this.children.delete(t),this.forwardTo.delete(t),(e=this.state)===null||e===void 0||delete e.children[t]}stopChild(t){const e=this.children.get(t);e&&(this.removeChild(t),y(e.stop)&&e.stop())}spawn(t,e,i){if(this.status!==w.Running)return Ei(t,e);if(Me(t))return this.spawnPromise(Promise.resolve(t),e);if(y(t))return this.spawnCallback(t,e);if(function(r){try{return typeof r.send=="function"}catch{return!1}}(o=t)&&"id"in o)return this.spawnActor(t,e);if(function(r){try{return"subscribe"in r&&y(r.subscribe)}catch{return!1}}(t))return this.spawnObservable(t,e);if(at(t))return this.spawnMachine(t,Object.assign(Object.assign({},i),{id:e}));if((n=t)!==null&&typeof n=="object"&&"transition"in n&&typeof n.transition=="function")return this.spawnBehavior(t,e);throw new Error(`Unable to spawn entity "${e}" of type "${typeof t}".`);var n,o}spawnMachine(t,e={}){const i=new Q(t,Object.assign(Object.assign({},this.options),{parent:this,id:e.id||t.id})),n=Object.assign(Object.assign({},ps),e);n.sync&&i.onTransition(r=>{this.send(Zt,{state:r,id:i.id})});const o=i;return this.children.set(i.id,o),n.autoForward&&this.forwardTo.add(i.id),i.onDone(r=>{this.removeChild(i.id),this.send(O(r,{origin:i.id}))}).start(),o}spawnBehavior(t,e){const i=us(t,{id:e,parent:this});return this.children.set(e,i),i}spawnPromise(t,e){let i,n=!1;t.then(r=>{n||(i=r,this.removeChild(e),this.send(O(xt(e,r),{origin:e})))},r=>{if(!n){this.removeChild(e);const c=nt(e,r);try{this.send(O(c,{origin:e}))}catch{this.devTools&&this.devTools.send(c,this.state),this.machine.strict&&this.stop()}}});const o={id:e,send:()=>{},subscribe:(r,c,a)=>{const h=Dt(r,c,a);let d=!1;return t.then(l=>{d||(h.next(l),d||h.complete())},l=>{d||h.error(l)}),{unsubscribe:()=>d=!0}},stop:()=>{n=!0},toJSON:()=>({id:e}),getSnapshot:()=>i,[J]:function(){return this}};return this.children.set(e,o),o}spawnCallback(t,e){let i=!1;const n=new Set,o=new Set;let r;const c=d=>{r=d,o.forEach(l=>l(d)),i||this.send(O(d,{origin:e}))};let a;try{a=t(c,d=>{n.add(d)})}catch(d){this.send(nt(e,d))}if(Me(a))return this.spawnPromise(a,e);const h={id:e,send:d=>n.forEach(l=>l(d)),subscribe:d=>{const l=Dt(d);return o.add(l.next),{unsubscribe:()=>{o.delete(l.next)}}},stop:()=>{i=!0,y(a)&&a()},toJSON:()=>({id:e}),getSnapshot:()=>r,[J]:function(){return this}};return this.children.set(e,h),h}spawnObservable(t,e){let i;const n=t.subscribe(r=>{i=r,this.send(O(r,{origin:e}))},r=>{this.removeChild(e),this.send(O(nt(e,r),{origin:e}))},()=>{this.removeChild(e),this.send(O(xt(e),{origin:e}))}),o={id:e,send:()=>{},subscribe:(r,c,a)=>t.subscribe(r,c,a),stop:()=>n.unsubscribe(),getSnapshot:()=>i,toJSON:()=>({id:e}),[J]:function(){return this}};return this.children.set(e,o),o}spawnActor(t,e){return this.children.set(e,t),t}spawnActivity(t){const e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(!e)return;const i=e(this.state.context,t);this.spawnEffect(t.id,i)}spawnEffect(t,e){this.children.set(t,{id:t,send:()=>{},subscribe:()=>({unsubscribe:()=>{}}),stop:e||void 0,getSnapshot:()=>{},toJSON:()=>({id:t}),[J]:function(){return this}})}attachDev(){const t=fe();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){const e=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(Object.assign(Object.assign({name:this.id,autoPause:!0,stateSanitizer:i=>({value:i.value,context:i.context,actions:i.actions})},e),{features:Object.assign({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}ls(this)}}toJSON(){return{id:this.id}}[J](){return this}getSnapshot(){return this.status===w.NotStarted?this.initialState:this._state}}Q.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:(s,t)=>setTimeout(s,t),clearTimeout:s=>clearTimeout(s)},logger:console.log.bind(console),devTools:!1},Q.interpret=ji;function ji(s,t){return new Q(s,t)}function fs(s){return typeof s=="string"?{type:s,toString:()=>s}:s}function It(s){return Object.assign(Object.assign({type:qt},s),{toJSON(){const t=$e(s,["onDone","onError"]);return Object.assign(Object.assign({},t),{type:qt,src:fs(s.src)})}})}const Y={},tt=s=>s[0]==="#";class wt{constructor(t,e,i="context"in t?t.context:void 0,n){var o;this.config=t,this._context=i,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign({actions:{},guards:{},services:{},activities:{},delays:{}},e),this.parent=n==null?void 0:n.parent,this.key=this.config.key||(n==null?void 0:n.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:"."),this.id=this.config.id||[this.machine.key,...this.path].join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?ft(this.config.states,(c,a)=>{const h=new wt(c,{},void 0,{parent:this,key:a});return Object.assign(this.idMap,Object.assign({[h.id]:h},h.idMap)),h}):Y;let r=0;(function c(a){a.order=r++;for(const h of Ai(a))c(h)})(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some(({event:c})=>c===""):""in this.config.on),this.strict=!!this.config.strict,this.onEntry=P(this.config.entry||this.config.onEntry).map(c=>ct(c)),this.onExit=P(this.config.exit||this.config.onExit).map(c=>ct(c)),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=P(this.config.invoke).map((c,a)=>{if(at(c)){const h=Pt(this.id,a);return this.machine.options.services=Object.assign({[h]:c},this.machine.options.services),It({src:h,id:h})}if(b(c.src)){const h=c.id||Pt(this.id,a);return It(Object.assign(Object.assign({},c),{id:h,src:c.src}))}if(at(c.src)||y(c.src)){const h=c.id||Pt(this.id,a);return this.machine.options.services=Object.assign({[h]:c.src},this.machine.options.services),It(Object.assign(Object.assign({id:h},c),{src:h}))}{const h=c.src;return It(Object.assign(Object.assign({id:Pt(this.id,a)},c),{src:h}))}}),this.activities=P(this.config.activities).concat(this.invoke).map(c=>te(c)),this.transition=this.transition.bind(this),this.tags=P(this.config.tags)}_init(){this.__cache.transitions||Oi(this).forEach(t=>t.on)}withConfig(t,e){const{actions:i,activities:n,guards:o,services:r,delays:c}=this.options;return new wt(this.config,{actions:Object.assign(Object.assign({},i),t.actions),activities:Object.assign(Object.assign({},n),t.activities),guards:Object.assign(Object.assign({},o),t.guards),services:Object.assign(Object.assign({},r),t.services),delays:Object.assign(Object.assign({},c),t.delays)},e!=null?e:this.context)}withContext(t){return new wt(this.config,this.options,t)}get context(){return y(this._context)?this._context():this._context}get definition(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:ft(this.states,t=>t.definition),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get on(){if(this.__cache.on)return this.__cache.on;const t=this.transitions;return this.__cache.on=t.reduce((e,i)=>(e[i.eventType]=e[i.eventType]||[],e[i.eventType].push(i),e),{})}get after(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)}get transitions(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)}getCandidates(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];const e=t==="",i=this.transitions.filter(n=>{const o=n.eventType===t;return e?o:o||n.eventType==="*"});return this.__cache.candidates[t]=i,i}getDelayedTransitions(){const t=this.config.after;if(!t)return[];const e=(i,n)=>{const o=xi(y(i)?`${this.id}:delay[${n}]`:i,this.id);return this.onEntry.push(st(o,{delay:i})),this.onExit.push(bi(o)),o};return(dt(t)?t.map((i,n)=>{const o=e(i.delay,n);return Object.assign(Object.assign({},i),{event:o})}):S(Object.keys(t).map((i,n)=>{const o=t[i],r=b(o)?{target:o}:o,c=isNaN(+i)?i:+i,a=e(c,n);return P(r).map(h=>Object.assign(Object.assign({},h),{event:a,delay:c}))}))).map(i=>{const{delay:n}=i;return Object.assign(Object.assign({},this.formatTransition(i)),{delay:n})})}getStateNodes(t){if(!t)return[];const e=t instanceof E?t.value:St(t,this.delimiter);if(b(e)){const o=this.getStateNode(e).initial;return o!==void 0?this.getStateNodes({[e]:o}):[this,this.states[e]]}const i=Object.keys(e),n=[this];return n.push(...S(i.map(o=>this.getStateNode(o).getStateNodes(e[o])))),n}handles(t){const e=hi(t);return this.events.includes(e)}resolveState(t){const e=t instanceof E?t:E.create(t),i=Array.from(vt([],this.getStateNodes(e.value)));return new E(Object.assign(Object.assign({},e),{value:this.resolve(e.value),configuration:i,done:Vt(i,this),tags:De(i),machine:this.machine}))}transitionLeafNode(t,e,i){const n=this.getStateNode(t).next(e,i);return n&&n.transitions.length?n:this.next(e,i)}transitionCompoundNode(t,e,i){const n=Object.keys(t),o=this.getStateNode(n[0])._transition(t[n[0]],e,i);return o&&o.transitions.length?o:this.next(e,i)}transitionParallelNode(t,e,i){const n={};for(const a of Object.keys(t)){const h=t[a];if(!h)continue;const d=this.getStateNode(a)._transition(h,e,i);d&&(n[a]=d)}const o=Object.keys(n).map(a=>n[a]),r=S(o.map(a=>a.transitions));if(!o.some(a=>a.transitions.length>0))return this.next(e,i);const c=S(Object.keys(n).map(a=>n[a].configuration));return{transitions:r,exitSet:S(o.map(a=>a.exitSet)),configuration:c,source:e,actions:S(Object.keys(n).map(a=>n[a].actions))}}_transition(t,e,i){return b(t)?this.transitionLeafNode(t,e,i):Object.keys(t).length===1?this.transitionCompoundNode(t,e,i):this.transitionParallelNode(t,e,i)}getTransitionData(t,e){return this._transition(t.value,t,O(e))}next(t,e){const i=e.name,n=[];let o,r=[];for(const a of this.getCandidates(i)){const{cond:h,in:d}=a,l=t.context,g=!d||(b(d)&&tt(d)?t.matches(St(this.getStateNodeById(d).path,this.delimiter)):_e(St(d,this.delimiter),ss(this.path.slice(0,-2))(t.value)));let p=!1;try{p=!h||pi(this.machine,h,l,e,t)}catch(m){throw new Error(`Unable to evaluate guard '${h.name||h.type}' in transition for event '${i}' in state node '${this.id}':
${m.message}`)}if(p&&g){a.target!==void 0&&(r=a.target),n.push(...a.actions),o=a;break}}if(!o)return;if(!r.length)return{transitions:[o],exitSet:[],configuration:t.value?[this]:[],source:t,actions:n};const c=S(r.map(a=>this.getRelativeStateNodes(a,t.historyValue)));return{transitions:[o],exitSet:o.internal?[]:S(r.map(a=>this.getPotentiallyReenteringNodes(a))),configuration:c,source:t,actions:n}}getPotentiallyReenteringNodes(t){if(this.order<t.order)return[this];const e=[];let i=this,n=t;for(;i&&i!==n;)e.push(i),i=i.parent;return i!==n?[]:(e.push(n),e)}getActions(t,e,i,n,o,r,c){const a=r?vt([],this.getStateNodes(r.value)):[],h=new Set;for(const u of Array.from(t).sort((v,x)=>v.order-x.order))(!yt(a,u)||yt(i.exitSet,u)||u.parent&&h.has(u.parent))&&h.add(u);for(const u of a)yt(t,u)&&!yt(i.exitSet,u.parent)||i.exitSet.push(u);i.exitSet.sort((u,v)=>v.order-u.order);const d=Array.from(h).sort((u,v)=>u.order-v.order),l=new Set(i.exitSet),g=S(d.map(u=>{const v=[];if(u.type!=="final")return v;const x=u.parent;if(!x.parent)return v;v.push(gt(u.id,u.doneData),gt(x.id,u.doneData?Ft(u.doneData,n,o):void 0));const f=x.parent;return f.type==="parallel"&&kt(f).every(T=>Vt(i.configuration,T))&&v.push(gt(f.id)),v})),p=d.map(u=>{const v=u.onEntry,x=u.activities.map(f=>_i(f));return{type:"entry",actions:I(c?[...v,...x]:[...x,...v],this.machine.options.actions)}}).concat({type:"state_done",actions:g.map(u=>gi(u))}),m=Array.from(l).map(u=>({type:"exit",actions:I([...u.onExit,...u.activities.map(v=>$i(v))],this.machine.options.actions)})).concat({type:"transition",actions:I(i.actions,this.machine.options.actions)}).concat(p);if(e){const u=I(S([...t].sort((v,x)=>x.order-v.order).map(v=>v.onExit)),this.machine.options.actions).filter(v=>!ue(v));return m.concat({type:"stop",actions:u})}return m}transition(t=this.initialState,e,i,n){const o=O(e);let r;if(t instanceof E)r=i===void 0?t:this.resolveState(E.from(t,i));else{const l=b(t)?this.resolve(Jt(this.getResolvedPath(t))):this.resolve(t),g=i!=null?i:this.machine.context;r=this.resolveState(E.from(l,g))}if(this.strict&&!this.events.includes(o.name)&&(c=o.name,!/^(done|error)\./.test(c)))throw new Error(`Machine '${this.id}' does not accept event '${o.name}'`);var c;const a=this._transition(r.value,r,o)||{transitions:[],configuration:[],exitSet:[],source:r,actions:[]},h=vt([],this.getStateNodes(r.value)),d=a.configuration.length?vt(h,a.configuration):h;return a.configuration=[...d],this.resolveTransition(a,r,r.context,n,o)}resolveRaisedTransition(t,e,i,n){const o=t.actions;return(t=this.transition(t,e,void 0,n))._event=i,t.event=i.data,t.actions.unshift(...o),t}resolveTransition(t,e,i,n,o=K){const{configuration:r}=t,c=!e||t.transitions.length>0,a=c?t.configuration:e?e.configuration:[],h=Vt(a,this),d=c?as(this.machine,r):void 0,l=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,g=this.getActions(new Set(a),h,t,i,o,e,n),p=e?Object.assign({},e.activities):{};for(const k of g)for(const $ of k.actions)$.type===zt?p[$.activity.id||$.activity.type]=$:$.type===Xt&&(p[$.activity.id||$.activity.type]=!1);const[m,u]=jt(this,e,i,o,g,n,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),[v,x]=function(k,$){const[j,R]=[[],[]];for(const B of k)$(B)?j.push(B):R.push(B);return[j,R]}(m,ue),f=m.filter(k=>{var $;return k.type===zt&&(($=k.activity)===null||$===void 0?void 0:$.type)===qt}).reduce((k,$)=>(k[$.activity.id]=function(j,R,B,Nt){var ee;const ki=fi(j.src),Se=(ee=R==null?void 0:R.options.services)===null||ee===void 0?void 0:ee[ki.type],Ti=j.data?Ft(j.data,B,Nt):void 0,xe=Se?Ei(Se,j.id,Ti):wi(j.id);return xe.meta=j,xe}($.activity,this.machine,u,o),k),e?Object.assign({},e.children):{}),T=new E({value:d||e.value,context:u,_event:o,_sessionid:e?e._sessionid:null,historyValue:d?l?(N=l,z=d,{current:z,states:li(N,z)}):void 0:e?e.historyValue:void 0,history:!d||t.source?e:void 0,actions:d?x:[],activities:d?p:e?e.activities:{},events:[],configuration:a,transitions:t.transitions,children:f,done:h,tags:De(a),machine:this});var N,z;const L=i!==u;T.changed=o.name===Zt||L;const{history:U}=T;U&&delete U.history;const G=!h&&(this._transient||r.some(k=>k._transient));if(!(c||G&&o.name!==""))return T;let C=T;if(!h)for(G&&(C=this.resolveRaisedTransition(C,{type:oi},o,n));v.length;){const k=v.shift();C=this.resolveRaisedTransition(C,k._event,o,n)}const M=C.changed||(U?!!C.actions.length||L||typeof U.value!=typeof C.value||!function k($,j){if($===j)return!0;if($===void 0||j===void 0)return!1;if(b($)||b(j))return $===j;const R=Object.keys($),B=Object.keys(j);return R.length===B.length&&R.every(Nt=>k($[Nt],j[Nt]))}(C.value,U.value):void 0);return C.changed=M,C.history=U,C}getStateNode(t){if(tt(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error(`Unable to retrieve child state '${t}' from '${this.id}'; no child states exist.`);const e=this.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${this.id}'`);return e}getStateNodeById(t){const e=tt(t)?t.slice(1):t;if(e===this.id)return this;const i=this.machine.idMap[e];if(!i)throw new Error(`Child state node '#${e}' does not exist on machine '${this.id}'`);return i}getStateNodeByPath(t){if(typeof t=="string"&&tt(t))try{return this.getStateNodeById(t.slice(1))}catch{}const e=le(t,this.delimiter).slice();let i=this;for(;e.length;){const n=e.shift();if(!n.length)break;i=i.getStateNode(n)}return i}resolve(t){if(!t)return this.initialStateValue||Y;switch(this.type){case"parallel":return ft(this.initialStateValue,(e,i)=>e?this.getStateNode(i).resolve(t[i]||e):Y);case"compound":if(b(t)){const e=this.getStateNode(t);return e.type==="parallel"||e.type==="compound"?{[t]:e.initialStateValue}:t}return Object.keys(t).length?ft(t,(e,i)=>e?this.getStateNode(i).resolve(e):Y):this.initialStateValue||{};default:return t||Y}}getResolvedPath(t){if(tt(t)){const e=this.machine.idMap[t.slice(1)];if(!e)throw new Error(`Unable to find state node '${t}'`);return e.path}return le(t,this.delimiter)}get initialStateValue(){if(this.__cache.initialStateValue)return this.__cache.initialStateValue;let t;if(this.type==="parallel")t=Ue(this.states,e=>e.initialStateValue||Y,e=>e.type!=="history");else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error(`Initial state '${this.initial}' not found on '${this.key}'`);t=Kt(this.states[this.initial])?this.initial:{[this.initial]:this.states[this.initial].initialStateValue}}else t={};return this.__cache.initialStateValue=t,this.__cache.initialStateValue}getInitialState(t,e){this._init();const i=this.getStateNodes(t);return this.resolveTransition({configuration:i,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,e!=null?e:this.machine.context,void 0)}get initialState(){const{initialStateValue:t}=this;if(!t)throw new Error(`Cannot retrieve initial state from simple state '${this.id}'.`);return this.getInitialState(t)}get target(){let t;if(this.type==="history"){const e=this.config;t=b(e.target)&&tt(e.target)?Jt(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t}getRelativeStateNodes(t,e,i=!0){return i?t.type==="history"?t.resolveHistory(e):t.initialStateNodes:[t]}get initialStateNodes(){return Kt(this)?[this]:this.type==="compound"&&!this.initial?[this]:S(Rt(this.initialStateValue).map(t=>this.getFromRelativePath(t)))}getFromRelativePath(t){if(!t.length)return[this];const[e,...i]=t;if(!this.states)throw new Error(`Cannot retrieve subPath '${e}' from node with no states`);const n=this.getStateNode(e);if(n.type==="history")return n.resolveHistory();if(!this.states[e])throw new Error(`Child state '${e}' does not exist on '${this.id}'`);return this.states[e].getFromRelativePath(i)}historyValue(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:Ue(this.states,(e,i)=>{if(!t)return e.historyValue();const n=b(t)?void 0:t[i];return e.historyValue(n||e.initialStateValue)},e=>!e.history)}}resolveHistory(t){if(this.type!=="history")return[this];const e=this.parent;if(!t){const r=this.target;return r?S(Rt(r).map(c=>e.getFromRelativePath(c))):e.initialStateNodes}const i=(n=e.path,o="states",r=>{let c=r;for(const a of n)c=c[o][a];return c})(t).current;var n,o;return b(i)?[e.getStateNode(i)]:S(Rt(i).map(r=>this.history==="deep"?e.getFromRelativePath(r):[e.states[r[0]]]))}get stateIds(){const t=S(Object.keys(this.states).map(e=>this.states[e].stateIds));return[this.id].concat(t)}get events(){if(this.__cache.events)return this.__cache.events;const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const i of Object.keys(t)){const n=t[i];if(n.states)for(const o of n.events)e.add(""+o)}return this.__cache.events=Array.from(e)}get ownEvents(){const t=new Set(this.transitions.filter(e=>!(!e.target&&!e.actions.length&&e.internal)).map(e=>e.eventType));return Array.from(t)}resolveTarget(t){if(t!==void 0)return t.map(e=>{if(!b(e))return e;const i=e[0]===this.delimiter;if(i&&!this.parent)return this.getStateNodeByPath(e.slice(1));const n=i?this.key+e:e;if(!this.parent)return this.getStateNodeByPath(n);try{return this.parent.getStateNodeByPath(n)}catch(o){throw new Error(`Invalid transition definition for state node '${this.id}':
${o.message}`)}})}formatTransition(t){const e=function(c){if(c!==void 0&&c!=="")return P(c)}(t.target),i="internal"in t?t.internal:!e||e.some(c=>b(c)&&c[0]===this.delimiter),{guards:n}=this.machine.options,o=this.resolveTarget(e),r=Object.assign(Object.assign({},t),{actions:I(P(t.actions)),cond:ui(t.cond,n),target:o,source:this,internal:i,eventType:t.event,toJSON:()=>Object.assign(Object.assign({},r),{target:r.target?r.target.map(c=>"#"+c.id):void 0,source:"#"+this.id})});return r}formatTransitions(){let t;if(this.config.on)if(Array.isArray(this.config.on))t=this.config.on;else{const c=this.config.on,a="*",h=c[a],d=h===void 0?[]:h,l=$e(c,[a+""]);t=S(Object.keys(l).map(g=>Z(g,l[g])).concat(Z("*",d)))}else t=[];const e=this.config.always?Z("",this.config.always):[],i=this.config.onDone?Z(String(gt(this.id)),this.config.onDone):[],n=S(this.invoke.map(c=>{const a=[];return c.onDone&&a.push(...Z(String(xt(c.id)),c.onDone)),c.onError&&a.push(...Z(String(nt(c.id)),c.onError)),a})),o=this.after,r=S([...i,...n,...t,...e].map(c=>P(c).map(a=>this.formatTransition(a))));for(const c of o)r.push(c);return r}}function gs(s,t){return new wt(s,t)}const{assign:He,cancel:Ps,send:Is,sendTo:Ls,sendParent:Us,sendUpdate:Ms,forwardTo:Rs,doneInvoke:Ds,raise:Vs,log:Hs,pure:zs,choose:Bs,stop:qs}=os;class vs{constructor(t,e,i){(this.host=t).addController(this),this.service=ji(e).start(),this.propKey=i}get state(){return this.service.getSnapshot()}get send(){return this.service.send}hostConnected(){this.service.onTransition(t=>{t.changed&&(this.propKey in this.host&&(this.host[this.propKey]=t),this.host.requestUpdate())})}hostDisconnected(){this.service.stop()}}const Lt={enabled:"enabled",disabled:"disabled"},Ut={increment:"INC",decrement:"DEC",toggle:"TOGGLE"},ys=s=>s.counter+1,ms=s=>s.counter-1,bs=s=>s.counter<10,_s=s=>s.counter>0,$s=gs({id:"counter",initial:"enabled",context:{counter:0},states:{[Lt.enabled]:{on:{[Ut.increment]:{actions:He({counter:ys}),cond:bs},[Ut.decrement]:{actions:He({counter:ms}),cond:_s},[Ut.toggle]:{target:Lt.disabled}}},[Lt.disabled]:{on:{[Ut.toggle]:{target:Lt.enabled}}}}}),Ss=Li`:host {
  --_mark-color: rgb(197, 197, 197);
  display: block;
  box-sizing: border-box;
}

:host([hidden]),
[hidden] {
  display: none !important;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

[aria-disabled=true] {
  opacity: 0.5;
  -webkit-user-select: none;
     -moz-user-select: none;
          user-select: none;
  pointer-events: none;
  cursor: default;
}

p {
  font-size: 1.5rem;
  min-width: 4.25rem;
  text-align: center;
  margin: auto;
  padding: 0.8333em;
  background-color: var(--_mark-color);
}

button {
  display: inline-block;
  min-width: 9.375rem;
  font: inherit;
  cursor: pointer;
  white-space: nowrap;
  border: none;
  color: rgb(245, 245, 245);
  background-color: rgb(51, 65, 85);
  padding: 0.75em;
}
button:first-child:not(:only-child) {
  margin-bottom: 1rem;
}

div {
  display: flex;
  align-items: center;
  max-width: 25rem;
  padding: 1em 2em;
  margin: auto;
  background-color: rgb(238, 238, 238);
  border: 0.0625rem solid var(--_mark-color);
  border-bottom: none;
}
div + div {
  border-top: 0.0625rem dashed var(--_mark-color);
  border-bottom: 0.0625rem solid var(--_mark-color);
}

span {
  display: flex;
  flex-direction: column;
  margin-right: 2rem;
}

::slotted(*) {
  white-space: nowrap;
}`;var W,mt;class Et extends $t{constructor(){super();we(this,W);this.counterController=new vs(this,$s,"_xstate")}updated(e){if(super.updated&&super.updated(e),e.has("_xstate")){const{context:i,event:n}=this._xstate,o=new CustomEvent("counterchange",{bubbles:!0,detail:{...i,...n}});this.dispatchEvent(o)}}render(){return ti`
      <slot></slot>
      <div aria-disabled="${lt(this,W,mt)}">
        <span>
          <button
            ?disabled="${lt(this,W,mt)}"
            data-counter="increment"
            @click=${()=>this.counterController.send("INC")}
          >
            Increment
          </button>
          <button
            ?disabled="${lt(this,W,mt)}"
            data-counter="decrement"
            @click=${()=>this.counterController.send("DEC")}
          >
            Decrement
          </button>
        </span>
        <p>${this.counterController.state.context.counter}</p>
      </div>
      <div>
        <button @click=${()=>this.counterController.send("TOGGLE")}>
          ${lt(this,W,mt)?"Enabled counter":"Disabled counter"}
        </button>
      </div>
    `}}W=new WeakSet,mt=function(){return this.counterController.state.value==="disabled"},Ct(Et,"is","xstate-counter"),Ct(Et,"properties",{_xstate:{type:Object,state:!0}}),Ct(Et,"styles",[Ss]);window.customElements.define(Et.is,Et);ni(ti` <xstate-counter @counterchange="${s=>console.log("==>",s.detail)}">
          <h1>
            State machine with
            <a target="_blank" rel="noopener noreferrer" href="https://xstate.js.org/docs/"
              >xstate</a
            >
            and
            <a
              href="https://lit.dev/docs/composition/controllers/"
              target="_blank"
              rel="noopener noreferrer"
              >Lit Controller</a
            >
          </h1>
        </xstate-counter>`,document.querySelector("body"));
