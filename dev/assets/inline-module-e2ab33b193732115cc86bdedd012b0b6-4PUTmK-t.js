var He=Object.defineProperty;var ze=(s,t,e)=>t in s?He(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var dt=(s,t,e)=>(ze(s,typeof t!="symbol"?t+"":t,e),e),Le=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var L=(s,t,e)=>(Le(s,t,"read from private field"),e?e.call(s):t.get(s)),jt=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const et=globalThis,xt=et.ShadowRoot&&(et.ShadyCSS===void 0||et.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Et=Symbol(),Dt=new WeakMap;let he=class{constructor(t,e,n){if(this._$cssResult$=!0,n!==Et)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(xt&&t===void 0){const n=e!==void 0&&e.length===1;n&&(t=Dt.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&Dt.set(e,t))}return t}toString(){return this.cssText}};const Ne=s=>new he(typeof s=="string"?s:s+"",void 0,Et),Be=(s,...t)=>{const e=s.length===1?s[0]:t.reduce((n,i,r)=>n+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[r+1],s[0]);return new he(e,s,Et)},Je=(s,t)=>{if(xt)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const n=document.createElement("style"),i=et.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=e.cssText,s.appendChild(n)}},Ht=xt?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return Ne(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:We,defineProperty:Ge,getOwnPropertyDescriptor:qe,getOwnPropertyNames:Ke,getOwnPropertySymbols:Xe,getPrototypeOf:Ye}=Object,b=globalThis,zt=b.trustedTypes,Ve=zt?zt.emptyScript:"",lt=b.reactiveElementPolyfillSupport,W=(s,t)=>s,_t={toAttribute(s,t){switch(t){case Boolean:s=s?Ve:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},de=(s,t)=>!We(s,t),Lt={attribute:!0,type:String,converter:_t,reflect:!1,hasChanged:de};var ne,ie;(ne=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(ie=b.litPropertyMetadata)!=null||(b.litPropertyMetadata=new WeakMap);class M extends HTMLElement{static addInitializer(t){var e;this._$Ei(),((e=this.l)!=null?e:this.l=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Lt){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(t,n,e);i!==void 0&&Ge(this.prototype,t,i)}}static getPropertyDescriptor(t,e,n){var o;const{get:i,set:r}=(o=qe(this.prototype,t))!=null?o:{get(){return this[e]},set(c){this[e]=c}};return{get(){return i==null?void 0:i.call(this)},set(c){const a=i==null?void 0:i.call(this);r.call(this,c),this.requestUpdate(t,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){var e;return(e=this.elementProperties.get(t))!=null?e:Lt}static _$Ei(){if(this.hasOwnProperty(W("elementProperties")))return;const t=Ye(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(W("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(W("properties"))){const e=this.properties,n=[...Ke(e),...Xe(e)];for(const i of n)this.createProperty(i,e[i])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[n,i]of e)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[e,n]of this.elementProperties){const i=this._$Eu(e,n);i!==void 0&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const i of n)e.unshift(Ht(i))}else t!==void 0&&e.push(Ht(t));return e}static _$Eu(t,e){const n=e.attribute;return n===!1?void 0:typeof n=="string"?n:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$Eg=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$ES(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e,n;((e=this._$E_)!=null?e:this._$E_=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&((n=t.hostConnected)==null||n.call(t))}removeController(t){var e;(e=this._$E_)==null||e.delete(t)}_$ES(){const t=new Map,e=this.constructor.elementProperties;for(const n of e.keys())this.hasOwnProperty(n)&&(t.set(n,this[n]),delete this[n]);t.size>0&&(this._$Ep=t)}createRenderRoot(){var e;const t=(e=this.shadowRoot)!=null?e:this.attachShadow(this.constructor.shadowRootOptions);return Je(t,this.constructor.elementStyles),t}connectedCallback(){var t,e;(t=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$E_)==null||e.forEach(n=>{var i;return(i=n.hostConnected)==null?void 0:i.call(n)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$E_)==null||t.forEach(e=>{var n;return(n=e.hostDisconnected)==null?void 0:n.call(e)})}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$EO(t,e){var r;const n=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,n);if(i!==void 0&&n.reflect===!0){const o=(((r=n.converter)==null?void 0:r.toAttribute)!==void 0?n.converter:_t).toAttribute(e,n.type);this._$Em=t,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(t,e){var r;const n=this.constructor,i=n._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const o=n.getPropertyOptions(i),c=typeof o.converter=="function"?{fromAttribute:o.converter}:((r=o.converter)==null?void 0:r.fromAttribute)!==void 0?o.converter:_t;this._$Em=i,this[i]=c.fromAttribute(e,o.type),this._$Em=null}}requestUpdate(t,e,n,i=!1,r){var o;if(t!==void 0){if(n!=null||(n=this.constructor.getPropertyOptions(t)),!((o=n.hasChanged)!=null?o:de)(i?r:this[t],e))return;this.C(t,e,n)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(t,e,n){var i;this._$AL.has(t)||this._$AL.set(t,e),n.reflect===!0&&this._$Em!==t&&((i=this._$Ej)!=null?i:this._$Ej=new Set).add(t)}async _$EP(){this.isUpdatePending=!0;try{await this._$Eg}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n,i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if((n=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[o,c]of this._$Ep)this[o]=c;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[o,c]of r)c.wrapped!==!0||this._$AL.has(o)||this[o]===void 0||this.C(o,this[o],c)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(i=this._$E_)==null||i.forEach(r=>{var o;return(o=r.hostUpdate)==null?void 0:o.call(r)}),this.update(e)):this._$ET()}catch(r){throw t=!1,this._$ET(),r}t&&this._$AE(e)}willUpdate(t){}_$AE(t){var e;(e=this._$E_)==null||e.forEach(n=>{var i;return(i=n.hostUpdated)==null?void 0:i.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EO(e,this[e]))),this._$ET()}updated(t){}firstUpdated(t){}}var re;M.elementStyles=[],M.shadowRootOptions={mode:"open"},M[W("elementProperties")]=new Map,M[W("finalized")]=new Map,lt==null||lt({ReactiveElement:M}),((re=b.reactiveElementVersions)!=null?re:b.reactiveElementVersions=[]).push("2.0.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const G=globalThis,nt=G.trustedTypes,Nt=nt?nt.createPolicy("lit-html",{createHTML:s=>s}):void 0,le="$lit$",v=`lit$${(Math.random()+"").slice(9)}$`,ue="?"+v,Ze=`<${ue}>`,k=document,X=()=>k.createComment(""),Y=s=>s===null||typeof s!="object"&&typeof s!="function",fe=Array.isArray,Fe=s=>fe(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",ut=`[ 	
\f\r]`,N=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Bt=/-->/g,Jt=/>/g,S=RegExp(`>|${ut}(?:([^\\s"'>=/]+)(${ut}*=${ut}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Wt=/'/g,Gt=/"/g,pe=/^(?:script|style|textarea|title)$/i,Qe=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),ye=Qe(1),U=Symbol.for("lit-noChange"),g=Symbol.for("lit-nothing"),qt=new WeakMap,x=k.createTreeWalker(k,129);function ge(s,t){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return Nt!==void 0?Nt.createHTML(t):t}const ts=(s,t)=>{const e=s.length-1,n=[];let i,r=t===2?"<svg>":"",o=N;for(let c=0;c<e;c++){const a=s[c];let h,d,l=-1,u=0;for(;u<a.length&&(o.lastIndex=u,d=o.exec(a),d!==null);)u=o.lastIndex,o===N?d[1]==="!--"?o=Bt:d[1]!==void 0?o=Jt:d[2]!==void 0?(pe.test(d[2])&&(i=RegExp("</"+d[2],"g")),o=S):d[3]!==void 0&&(o=S):o===S?d[0]===">"?(o=i!=null?i:N,l=-1):d[1]===void 0?l=-2:(l=o.lastIndex-d[2].length,h=d[1],o=d[3]===void 0?S:d[3]==='"'?Gt:Wt):o===Gt||o===Wt?o=S:o===Bt||o===Jt?o=N:(o=S,i=void 0);const f=o===S&&s[c+1].startsWith("/>")?" ":"";r+=o===N?a+Ze:l>=0?(n.push(h),a.slice(0,l)+le+a.slice(l)+v+f):a+v+(l===-2?c:f)}return[ge(s,r+(s[e]||"<?>")+(t===2?"</svg>":"")),n]};class V{constructor({strings:t,_$litType$:e},n){let i;this.parts=[];let r=0,o=0;const c=t.length-1,a=this.parts,[h,d]=ts(t,e);if(this.el=V.createElement(h,n),x.currentNode=this.el.content,e===2){const l=this.el.content.firstChild;l.replaceWith(...l.childNodes)}for(;(i=x.nextNode())!==null&&a.length<c;){if(i.nodeType===1){if(i.hasAttributes())for(const l of i.getAttributeNames())if(l.endsWith(le)){const u=d[o++],f=i.getAttribute(l).split(v),p=/([.?@])?(.*)/.exec(u);a.push({type:1,index:r,name:p[2],strings:f,ctor:p[1]==="."?ss:p[1]==="?"?ns:p[1]==="@"?is:ct}),i.removeAttribute(l)}else l.startsWith(v)&&(a.push({type:6,index:r}),i.removeAttribute(l));if(pe.test(i.tagName)){const l=i.textContent.split(v),u=l.length-1;if(u>0){i.textContent=nt?nt.emptyScript:"";for(let f=0;f<u;f++)i.append(l[f],X()),x.nextNode(),a.push({type:2,index:++r});i.append(l[u],X())}}}else if(i.nodeType===8)if(i.data===ue)a.push({type:2,index:r});else{let l=-1;for(;(l=i.data.indexOf(v,l+1))!==-1;)a.push({type:7,index:r}),l+=v.length-1}r++}}static createElement(t,e){const n=k.createElement("template");return n.innerHTML=t,n}}function j(s,t,e=s,n){var o,c,a;if(t===U)return t;let i=n!==void 0?(o=e._$Co)==null?void 0:o[n]:e._$Cl;const r=Y(t)?void 0:t._$litDirective$;return(i==null?void 0:i.constructor)!==r&&((c=i==null?void 0:i._$AO)==null||c.call(i,!1),r===void 0?i=void 0:(i=new r(s),i._$AT(s,e,n)),n!==void 0?((a=e._$Co)!=null?a:e._$Co=[])[n]=i:e._$Cl=i),i!==void 0&&(t=j(s,i._$AS(s,t.values),i,n)),t}class es{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var h;const{el:{content:e},parts:n}=this._$AD,i=((h=t==null?void 0:t.creationScope)!=null?h:k).importNode(e,!0);x.currentNode=i;let r=x.nextNode(),o=0,c=0,a=n[0];for(;a!==void 0;){if(o===a.index){let d;a.type===2?d=new F(r,r.nextSibling,this,t):a.type===1?d=new a.ctor(r,a.name,a.strings,this,t):a.type===6&&(d=new rs(r,this,t)),this._$AV.push(d),a=n[++c]}o!==(a==null?void 0:a.index)&&(r=x.nextNode(),o++)}return x.currentNode=k,i}p(t){let e=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class F{get _$AU(){var t,e;return(e=(t=this._$AM)==null?void 0:t._$AU)!=null?e:this._$Cv}constructor(t,e,n,i){var r;this.type=2,this._$AH=g,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=i,this._$Cv=(r=i==null?void 0:i.isConnected)!=null?r:!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=j(this,t,e),Y(t)?t===g||t==null||t===""?(this._$AH!==g&&this._$AR(),this._$AH=g):t!==this._$AH&&t!==U&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):Fe(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==g&&Y(this._$AH)?this._$AA.nextSibling.data=t:this.$(k.createTextNode(t)),this._$AH=t}g(t){var r;const{values:e,_$litType$:n}=t,i=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=V.createElement(ge(n.h,n.h[0]),this.options)),n);if(((r=this._$AH)==null?void 0:r._$AD)===i)this._$AH.p(e);else{const o=new es(i,this),c=o.u(this.options);o.p(e),this.$(c),this._$AH=o}}_$AC(t){let e=qt.get(t.strings);return e===void 0&&qt.set(t.strings,e=new V(t)),e}T(t){fe(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,i=0;for(const r of t)i===e.length?e.push(n=new F(this.k(X()),this.k(X()),this,this.options)):n=e[i],n._$AI(r),i++;i<e.length&&(this._$AR(n&&n._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,e);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class ct{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,n,i,r){this.type=1,this._$AH=g,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=g}_$AI(t,e=this,n,i){const r=this.strings;let o=!1;if(r===void 0)t=j(this,t,e,0),o=!Y(t)||t!==this._$AH&&t!==U,o&&(this._$AH=t);else{const c=t;let a,h;for(t=r[0],a=0;a<r.length-1;a++)h=j(this,c[n+a],e,a),h===U&&(h=this._$AH[a]),o||(o=!Y(h)||h!==this._$AH[a]),h===g?t=g:t!==g&&(t+=(h!=null?h:"")+r[a+1]),this._$AH[a]=h}o&&!i&&this.O(t)}O(t){t===g?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t!=null?t:"")}}class ss extends ct{constructor(){super(...arguments),this.type=3}O(t){this.element[this.name]=t===g?void 0:t}}class ns extends ct{constructor(){super(...arguments),this.type=4}O(t){this.element.toggleAttribute(this.name,!!t&&t!==g)}}class is extends ct{constructor(t,e,n,i,r){super(t,e,n,i,r),this.type=5}_$AI(t,e=this){var o;if((t=(o=j(this,t,e,0))!=null?o:g)===U)return;const n=this._$AH,i=t===g&&n!==g||t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive,r=t!==g&&(n===g||i);i&&this.element.removeEventListener(this.name,this,n),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;typeof this._$AH=="function"?this._$AH.call((n=(e=this.options)==null?void 0:e.host)!=null?n:this.element,t):this._$AH.handleEvent(t)}}class rs{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){j(this,t)}}const ft=G.litHtmlPolyfillSupport;var oe;ft==null||ft(V,F),((oe=G.litHtmlVersions)!=null?oe:G.litHtmlVersions=[]).push("3.1.0");const _e=(s,t,e)=>{var r,o;const n=(r=e==null?void 0:e.renderBefore)!=null?r:t;let i=n._$litPart$;if(i===void 0){const c=(o=e==null?void 0:e.renderBefore)!=null?o:null;n._$litPart$=i=new F(t.insertBefore(X(),c),c,void 0,e!=null?e:{})}return i._$AI(s),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class q extends M{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,n;const t=super.createRenderRoot();return(n=(e=this.renderOptions).renderBefore)!=null||(e.renderBefore=t.firstChild),t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=_e(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return U}}var ce;q._$litElement$=!0,q.finalized=!0,(ce=globalThis.litElementHydrateSupport)==null||ce.call(globalThis,{LitElement:q});const pt=globalThis.litElementPolyfillSupport;pt==null||pt({LitElement:q});var ae;((ae=globalThis.litElementVersions)!=null?ae:globalThis.litElementVersions=[]).push("4.0.2");function os(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function cs(){const s=os();if(s.__xstate__)return s.__xstate__}const as=s=>{if(typeof window>"u")return;const t=cs();t&&t.register(s)};class Kt{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){const e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),this._current=t.next}this._last=null}}const at=".",hs="",me="",ds="#",ls="*",ve="xstate.init",mt="xstate.stop";function us(s,t){const e=t?`#${t}`:"";return{type:`xstate.after(${s})${e}`}}function vt(s,t){return{type:`xstate.done.state.${s}`,output:t}}function fs(s,t){return{type:`xstate.done.actor.${s}`,output:t}}function K(s,t){return{type:`xstate.error.actor.${s}`,data:t}}function $e(s){return{type:ve,input:s}}function I(s){setTimeout(()=>{throw s})}const ps=typeof Symbol=="function"&&Symbol.observable||"@@observable";let ys=0;function gs(s){const t=new Map,e=new Map,n=new WeakMap,i=new Set,r={_bookId:()=>`x:${ys++}`,_register:(o,c)=>(t.set(o,c),o),_unregister:o=>{t.delete(o.sessionId);const c=n.get(o);c!==void 0&&(e.delete(c),n.delete(o))},get:o=>e.get(o),_set:(o,c)=>{const a=e.get(o);if(a&&a!==c)throw new Error(`Actor with system ID '${o}' already exists.`);e.set(o,c),n.set(c,o)},inspect:o=>{i.add(o)},_sendInspectionEvent:o=>{const c={...o,rootId:s.sessionId};i.forEach(a=>{var h;return(h=a.next)==null?void 0:h.call(a,c)})},_relay:(o,c,a)=>{r._sendInspectionEvent({type:"@xstate.event",sourceRef:o,actorRef:c,event:a}),c._send(a)}};return r}function be(s,t){const e=Xt(s),n=Xt(t);return typeof n=="string"?typeof e=="string"?n===e:!1:typeof e=="string"?e in n:Object.keys(e).every(i=>i in n?be(e[i],n[i]):!1)}function Ae(s){try{return xe(s)?s:s.split(at)}catch{throw new Error(`'${s}' is not a valid state path.`)}}function Xt(s){if(Ks(s))return s.value;if(typeof s!="string")return s;const t=Ae(s);return _s(t)}function _s(s){if(s.length===1)return s[0];const t={};let e=t;for(let n=0;n<s.length-1;n++)if(n===s.length-2)e[s[n]]=s[n+1];else{const i=e;e={},i[s[n]]=e}return t}function Yt(s,t){const e={},n=Object.keys(s);for(let i=0;i<n.length;i++){const r=n[i];e[r]=t(s[r],r,s,i)}return e}function Se(s){return[].concat(...s)}function we(s){return xe(s)?s:[s]}function $(s){return s===void 0?[]:we(s)}function $t(s,t,e,n){return typeof s=="function"?s({context:t,event:e,self:n}):s}function xe(s){return Array.isArray(s)}function ms(s){return s.type.startsWith("xstate.error.actor")}function P(s){return we(s).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function Ee(s){if(!(s===void 0||s===hs))return $(s)}function Vt(s,t,e){var r,o,c;const n=typeof s=="object",i=n?s:void 0;return{next:(r=n?s.next:s)==null?void 0:r.bind(i),error:(o=n?s.error:t)==null?void 0:o.bind(i),complete:(c=n?s.complete:e)==null?void 0:c.bind(i)}}function Zt(s,t){return`${s}[${t}]`}function Tt(s,t){if(t.startsWith("xstate#")){const[,e]=t.match(/\[(\d+)\]$/),i=s.getStateNodeById(t.slice(7,-(e.length+2))).config.invoke;return(Array.isArray(i)?i[e]:i).src}return s.implementations.actors[t]}const kt=1;let _=function(s){return s[s.NotStarted=0]="NotStarted",s[s.Running=1]="Running",s[s.Stopped=2]="Stopped",s}({});const vs={clock:{setTimeout:(s,t)=>setTimeout(s,t),clearTimeout:s=>clearTimeout(s)},logger:console.log.bind(console),devTools:!1};class $s{constructor(t,e){var l,u;this.logic=t,this._state=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new Kt(this._process.bind(this)),this.delayedEventsMap={},this.observers=new Set,this.logger=void 0,this._processingStatus=_.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const n={...vs,...e},{clock:i,logger:r,parent:o,syncSnapshot:c,id:a,systemId:h,inspect:d}=n;this.system=(l=o==null?void 0:o.system)!=null?l:gs(this),d&&!o&&this.system.inspect(Vt(d)),this.sessionId=this.system._bookId(),this.id=a!=null?a:this.sessionId,this.logger=r,this.clock=i,this._parent=o,this._syncSnapshot=c,this.options=n,this.src=(u=n.src)!=null?u:t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:f=>{this._deferred.push(f)},system:this.system,stopChild:f=>{if(f._parent!==this)throw new Error(`Cannot stop child actor ${f.id} of ${this.id} because it is not a child`);f._stop()}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),h&&(this._systemId=h,this.system._set(h,this)),this._initState(e==null?void 0:e.state),h&&this._state.status!=="active"&&this.system._unregister(this)}_initState(t){var e;this._state=t?this.logic.restoreState?this.logic.restoreState(t,this._actorScope):t:this.logic.getInitialState(this._actorScope,(e=this.options)==null?void 0:e.input)}update(t,e){var i;this._state=t;let n;for(;n=this._deferred.shift();)n();for(const r of this.observers)try{(i=r.next)==null||i.call(r,t)}catch(o){I(o)}switch(this._state.status){case"done":this._stopProcedure(),this._complete(),this._doneEvent=fs(this.id,this._state.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._stopProcedure(),this._error(this._state.error),this._parent&&this.system._relay(this,this._parent,K(this.id,this._state.error));break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:e,snapshot:t})}subscribe(t,e,n){var r;const i=Vt(t,e,n);if(this._processingStatus!==_.Stopped)this.observers.add(i);else try{(r=i.complete)==null||r.call(i)}catch(o){I(o)}return{unsubscribe:()=>{this.observers.delete(i)}}}start(){var n;if(this._processingStatus===_.Running)return this;this._syncSnapshot&&this.subscribe({next:i=>{i.status==="active"&&this._parent.send({type:`xstate.snapshot.${this.id}`,snapshot:i})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=_.Running;const t=$e(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._state.status){case"done":this.update(this._state,t);case"error":return this}if(this.logic.start)try{this.logic.start(this._state,this._actorScope)}catch(i){return this._stopProcedure(),this._error(i),(n=this._parent)==null||n.send(K(this.id,i)),this}return this.update(this._state,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){var i;let e,n;try{e=this.logic.transition(this._state,t,this._actorScope)}catch(r){n={err:r}}if(n){const{err:r}=n;this._stopProcedure(),this._error(r),(i=this._parent)==null||i.send(K(this.id,r));return}this.update(e,t),t.type===mt&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===_.Stopped?this:(this.mailbox.clear(),this._processingStatus===_.NotStarted?(this._processingStatus=_.Stopped,this):(this.mailbox.enqueue({type:mt}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){var t;for(const e of this.observers)try{(t=e.complete)==null||t.call(e)}catch(n){I(n)}this.observers.clear()}_error(t){if(!this.observers.size){this._parent||I(t);return}let e=!1;for(const n of this.observers){const i=n.error;e||(e=!i);try{i==null||i(t)}catch(r){I(r)}}this.observers.clear(),e&&I(t)}_stopProcedure(){if(this._processingStatus!==_.Running)return this;for(const t of Object.keys(this.delayedEventsMap))this.clock.clearTimeout(this.delayedEventsMap[t]);return this.mailbox.clear(),this.mailbox=new Kt(this._process.bind(this)),this._processingStatus=_.Stopped,this.system._unregister(this),this}_send(t){this._processingStatus!==_.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}delaySend(t){const{event:e,id:n,delay:i}=t,r=this.clock.setTimeout(()=>{var o;this.system._relay(this,(o=t.to)!=null?o:this,e)},i);n&&(this.delayedEventsMap[n]=r)}cancel(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:as)(this)}toJSON(){return{xstate$$type:kt,id:this.id}}getPersistedState(t){return this.logic.getPersistedState(this._state,t)}[ps](){return this}getSnapshot(){return this._state}}function Z(s,t){return new $s(s,t)}function bs(s,t,e,n,{sendId:i}){const r=typeof i=="function"?i(e,n):i;return[t,r]}function As(s,t){s.self.cancel(t)}function Ss(s){function t(e,n){}return t.type="xstate.cancel",t.sendId=s,t.resolve=bs,t.execute=As,t}function ws(s,t,e,n,{id:i,systemId:r,src:o,input:c,syncSnapshot:a}){const h=typeof o=="string"?Tt(t.machine,o):o,d=typeof i=="function"?i(e):i;let l;return h&&(l=Z(h,{id:d,src:o,parent:s==null?void 0:s.self,syncSnapshot:a,systemId:r,input:typeof c=="function"?c({context:t.context,event:e.event,self:s==null?void 0:s.self}):c})),[C(t,{children:{...t.children,[d]:l}}),{id:i,actorRef:l}]}function xs(s,{id:t,actorRef:e}){e&&s.defer(()=>{var n;if(e._processingStatus!==_.Stopped)try{(n=e.start)==null||n.call(e)}catch(i){s.self.send(K(t,i));return}})}function Es(...[s,{id:t,systemId:e,input:n,syncSnapshot:i=!1}={}]){function r(o,c){}return r.type="xstate.spawn",r.id=t,r.systemId=e,r.src=s,r.input=n,r.syncSnapshot=i,r.resolve=ws,r.execute=xs,r}function Ts(s,t,e,n,{actorRef:i}){const r=typeof i=="function"?i(e,n):i,o=typeof r=="string"?t.children[r]:r;let c=t.children;return o&&(c={...c},delete c[o.id]),[C(t,{children:c}),o]}function ks(s,t){if(t){if(s.system._unregister(t),t._processingStatus!==_.Running){s.stopChild(t);return}s.defer(()=>{s.stopChild(t)})}}function Te(s){function t(e,n){}return t.type="xstate.stop",t.actorRef=s,t.resolve=Ts,t.execute=ks,t}function Ct(s,t,e,n){const{machine:i}=n,r=typeof s=="function",o=r?s:i.implementations.guards[typeof s=="string"?s:s.type];if(!r&&!o)throw new Error(`Guard '${typeof s=="string"?s:s.type}' is not implemented.'.`);if(typeof o!="function")return Ct(o,t,e,n);const c={context:t,event:e},a=r||typeof s=="string"?void 0:"params"in s?typeof s.params=="function"?s.params({context:t,event:e}):s.params:void 0;return"check"in o?o.check(n,c,o):o(c,a)}const It=s=>s.type==="atomic"||s.type==="final";function D(s){return Object.values(s.states).filter(t=>t.type!=="history")}function Q(s,t){const e=[];if(t===s)return e;let n=s.parent;for(;n&&n!==t;)e.push(n),n=n.parent;return e}function it(s){const t=new Set(s),e=Ce(t);for(const n of t)if(n.type==="compound"&&(!e.get(n)||!e.get(n).length))Ft(n).forEach(i=>t.add(i));else if(n.type==="parallel"){for(const i of D(n))if(i.type!=="history"&&!t.has(i)){const r=Ft(i);for(const o of r)t.add(o)}}for(const n of t){let i=n.parent;for(;i;)t.add(i),i=i.parent}return t}function ke(s,t){const e=t.get(s);if(!e)return{};if(s.type==="compound"){const i=e[0];if(i){if(It(i))return i.key}else return{}}const n={};for(const i of e)n[i.key]=ke(i,t);return n}function Ce(s){const t=new Map;for(const e of s)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function Ie(s,t){const e=it(t);return ke(s,Ce(e))}function Ot(s,t){return t.type==="compound"?D(t).some(e=>e.type==="final"&&s.has(e)):t.type==="parallel"?D(t).every(e=>Ot(s,e)):t.type==="final"}const ht=s=>s[0]===ds;function Cs(s,t){return s.transitions.get(t)||[...s.transitions.keys()].filter(n=>{if(n===ls)return!0;if(!n.endsWith(".*"))return!1;const i=n.split("."),r=t.split(".");for(let o=0;o<i.length;o++){const c=i[o],a=r[o];if(c==="*")return o===i.length-1;if(c!==a)return!1}return!0}).sort((n,i)=>i.length-n.length).flatMap(n=>s.transitions.get(n))}function Is(s){const t=s.config.after;if(!t)return[];const e=(i,r)=>{const o=typeof i=="function"?`${s.id}:delay[${r}]`:i,c=us(o,s.id),a=c.type;return s.entry.push(nn(c,{id:a,delay:i})),s.exit.push(Ss(a)),a};return Object.keys(t).flatMap((i,r)=>{const o=t[i],c=typeof o=="string"?{target:o}:o,a=isNaN(+i)?i:+i,h=e(a,r);return $(c).map(d=>({...d,event:h,delay:a}))}).map(i=>{const{delay:r}=i;return{...w(s,i.event,i),delay:r}})}function w(s,t,e){var c;const n=Ee(e.target),i=(c=e.reenter)!=null?c:!1,r=Ps(s,n),o={...e,actions:$(e.actions),guard:e.guard,target:r,source:s,reenter:i,eventType:t,toJSON:()=>({...o,source:`#${s.id}`,target:r?r.map(a=>`#${a.id}`):void 0})};return o}function Os(s){const t=new Map;if(s.config.on)for(const e of Object.keys(s.config.on)){if(e===me)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const n=s.config.on[e];t.set(e,P(n).map(i=>w(s,e,i)))}if(s.config.onDone){const e=`xstate.done.state.${s.id}`;t.set(e,P(s.config.onDone).map(n=>w(s,e,n)))}for(const e of s.invoke){if(e.onDone){const n=`xstate.done.actor.${e.id}`;t.set(n,P(e.onDone).map(i=>w(s,n,i)))}if(e.onError){const n=`xstate.error.actor.${e.id}`;t.set(n,P(e.onError).map(i=>w(s,n,i)))}if(e.onSnapshot){const n=`xstate.snapshot.${e.id}`;t.set(n,P(e.onSnapshot).map(i=>w(s,n,i)))}}for(const e of s.after){let n=t.get(e.eventType);n||(n=[],t.set(e.eventType,n)),n.push(e)}return t}function Ms(s,t){const e=typeof t=="string"?s.states[t]:t?s.states[t.target]:void 0;if(!e&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${s.id}`);const n={source:s,actions:!t||typeof t=="string"?[]:$(t.actions),eventType:null,reenter:!1,target:e?[e]:[],toJSON:()=>({...n,source:`#${s.id}`,target:e?[`#${e.id}`]:[]})};return n}function Ps(s,t){if(t!==void 0)return t.map(e=>{if(typeof e!="string")return e;if(ht(e))return s.machine.getStateNodeById(e);const n=e[0]===at;if(n&&!s.parent)return rt(s,e.slice(1));const i=n?s.key+e:e;if(s.parent)try{return rt(s.parent,i)}catch(r){throw new Error(`Invalid transition definition for state node '${s.id}':
${r.message}`)}else throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`)})}function Oe(s){const t=Ee(s.config.target);return t?{target:t.map(e=>typeof e=="string"?rt(s.parent,e):e)}:s.parent.initial}function E(s){return s.type==="history"}function Ft(s){const t=Me(s);for(const e of t)for(const n of Q(e,s))t.add(n);return t}function Me(s){const t=new Set;function e(n){if(!t.has(n)){if(t.add(n),n.type==="compound")e(n.initial.target[0]);else if(n.type==="parallel")for(const i of D(n))e(i)}}return e(s),t}function H(s,t){if(ht(t))return s.machine.getStateNodeById(t);if(!s.states)throw new Error(`Unable to retrieve child state '${t}' from '${s.id}'; no child states exist.`);const e=s.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${s.id}'`);return e}function rt(s,t){if(typeof t=="string"&&ht(t))try{return s.machine.getStateNodeById(t)}catch{}const e=Ae(t).slice();let n=s;for(;e.length;){const i=e.shift();if(!i.length)break;n=H(n,i)}return n}function ot(s,t){if(typeof t=="string")return[s,s.states[t]];const e=Object.keys(t),n=e.map(i=>H(s,i)).filter(Boolean);return[s.machine.root,s].concat(n,e.reduce((i,r)=>{const o=H(s,r);if(!o)return i;const c=ot(o,t[r]);return i.concat(c)},[]))}function Rs(s,t,e,n){const r=H(s,t).next(e,n);return!r||!r.length?s.next(e,n):r}function Us(s,t,e,n){const i=Object.keys(t),r=H(s,i[0]),o=Mt(r,t[i[0]],e,n);return!o||!o.length?s.next(e,n):o}function js(s,t,e,n){const i=[];for(const r of Object.keys(t)){const o=t[r];if(!o)continue;const c=H(s,r),a=Mt(c,o,e,n);a&&i.push(...a)}return i.length?i:s.next(e,n)}function Mt(s,t,e,n){return typeof t=="string"?Rs(s,t,e,n):Object.keys(t).length===1?Us(s,t,e,n):js(s,t,e,n)}function Ds(s){return Object.keys(s.states).map(t=>s.states[t]).filter(t=>t.type==="history")}function A(s,t){let e=s;for(;e.parent&&e.parent!==t;)e=e.parent;return e.parent===t}function Hs(s,t){const e=new Set(s),n=new Set(t);for(const i of e)if(n.has(i))return!0;for(const i of n)if(e.has(i))return!0;return!1}function Pe(s,t,e){const n=new Set;for(const i of s){let r=!1;const o=new Set;for(const c of n)if(Hs(bt([i],t,e),bt([c],t,e)))if(A(i.source,c.source))o.add(c);else{r=!0;break}if(!r){for(const c of o)n.delete(c);n.add(i)}}return Array.from(n)}function zs(s){const[t,...e]=s;for(const n of Q(t,void 0))if(e.every(i=>A(i,n)))return n}function Pt(s,t){if(!s.target)return[];const e=new Set;for(const n of s.target)if(E(n))if(t[n.id])for(const i of t[n.id])e.add(i);else for(const i of Pt(Oe(n),t))e.add(i);else e.add(n);return[...e]}function Re(s,t){const e=Pt(s,t);if(!e)return;if(!s.reenter&&e.every(i=>i===s.source||A(i,s.source)))return s.source;const n=zs(e.concat(s.source));if(n)return n;if(!s.reenter)return s.source.machine.root}function bt(s,t,e){var i;const n=new Set;for(const r of s)if((i=r.target)!=null&&i.length){const o=Re(r,e);r.reenter&&r.source===o&&n.add(o);for(const c of t)A(c,o)&&n.add(c)}return[...n]}function Ls(s,t){if(s.length!==t.size)return!1;for(const e of s)if(!t.has(e))return!1;return!0}function At(s,t,e,n,i,r){if(!s.length)return t;const o=new Set(t._nodes);let c=t.historyValue;const a=Pe(s,o,c);let h=t;i||([h,c]=Ws(h,n,e,a,o,c,r)),h=z(h,n,e,a.flatMap(l=>l.actions),r),h=Bs(h,n,e,a,o,r,c,i);const d=[...o];h.status==="done"&&(h=z(h,n,e,d.sort((l,u)=>u.order-l.order).flatMap(l=>l.exit),r));try{return c===t.historyValue&&Ls(t._nodes,o)?h:C(h,{_nodes:d,historyValue:c})}catch(l){throw l}}function Ns(s,t,e,n,i){if(!n.output)return;const r=vt(i.id,i.output&&i.parent?$t(i.output,s.context,t,e.self):void 0);return $t(n.output,s.context,r,e.self)}function Bs(s,t,e,n,i,r,o,c){let a=s;const h=new Set,d=new Set;Js(n,o,d,h),c&&d.add(s.machine.root);const l=new Set;for(const u of[...h].sort((f,p)=>f.order-p.order)){i.add(u);const f=[];f.push(...u.entry);for(const p of u.invoke)f.push(Es(p.src,{...p,syncSnapshot:!!p.onSnapshot}));if(d.has(u)){const p=u.initial.actions;f.push(...p)}if(a=z(a,t,e,f,r,u.invoke.map(p=>p.id)),u.type==="final"){const p=u.parent;let y=(p==null?void 0:p.type)==="parallel"?p:p==null?void 0:p.parent,m=y||u;for((p==null?void 0:p.type)==="compound"&&r.push(vt(p.id,u.output?$t(u.output,a.context,t,e.self):void 0));(y==null?void 0:y.type)==="parallel"&&!l.has(y)&&Ot(i,y);)l.add(y),r.push(vt(y.id)),m=y,y=y.parent;if(y)continue;a=C(a,{status:"done",output:Ns(a,t,e,a.machine.root,m)})}}return a}function Js(s,t,e,n){for(const i of s){const r=Re(i,t);for(const c of i.target||[])!E(c)&&(i.source!==c||i.source!==r||i.reenter)&&(n.add(c),e.add(c)),R(c,t,e,n);const o=Pt(i,t);for(const c of o){const a=Q(c,r);(r==null?void 0:r.type)==="parallel"&&a.push(r),Ue(n,t,e,a,!i.source.parent&&i.reenter?void 0:r)}}}function R(s,t,e,n){var i;if(E(s))if(t[s.id]){const r=t[s.id];for(const o of r)n.add(o),R(o,t,e,n);for(const o of r)yt(o,s.parent,n,t,e)}else{const r=Oe(s);for(const o of r.target)n.add(o),r===((i=s.parent)==null?void 0:i.initial)&&e.add(s.parent),R(o,t,e,n);for(const o of r.target)yt(o,s,n,t,e)}else if(s.type==="compound"){const[r]=s.initial.target;E(r)||(n.add(r),e.add(r)),R(r,t,e,n),yt(r,s,n,t,e)}else if(s.type==="parallel")for(const r of D(s).filter(o=>!E(o)))[...n].some(o=>A(o,r))||(E(r)||(n.add(r),e.add(r)),R(r,t,e,n))}function Ue(s,t,e,n,i){for(const r of n)if((!i||A(r,i))&&s.add(r),r.type==="parallel")for(const o of D(r).filter(c=>!E(c)))[...s].some(c=>A(c,o))||(s.add(o),R(o,t,e,s))}function yt(s,t,e,n,i){Ue(e,n,i,Q(s,t))}function Ws(s,t,e,n,i,r,o){let c=s;const a=bt(n,i,r);a.sort((d,l)=>l.order-d.order);let h;for(const d of a)for(const l of Ds(d)){let u;l.history==="deep"?u=f=>It(f)&&A(f,d):u=f=>f.parent===d,h!=null||(h={...r}),h[l.id]=Array.from(i).filter(u)}for(const d of a)c=z(c,t,e,[...d.exit,...d.invoke.map(l=>Te(l.id))],o),i.delete(d);return[c,h||r]}function je(s,t,e,n,i,r){const{machine:o}=s;let c=s;for(const a of n){const h=typeof a=="function",d=h?a:o.implementations.actions[typeof a=="string"?a:a.type];if(!d)continue;const l={context:c.context,event:t,self:e==null?void 0:e.self,system:e==null?void 0:e.system},u=h||typeof a=="string"?void 0:"params"in a?typeof a.params=="function"?a.params({context:c.context,event:t}):a.params:void 0;if(!("resolve"in d)){(e==null?void 0:e.self._processingStatus)===_.Running?d(l,u):e==null||e.defer(()=>{d(l,u)});continue}const f=d,[p,y,m]=f.resolve(e,c,l,u,d,i);c=p,"retryResolve"in f&&(r==null||r.push([f,y])),"execute"in f&&((e==null?void 0:e.self._processingStatus)===_.Running?f.execute(e,y):e==null||e.defer(f.execute.bind(null,e,y))),m&&(c=je(c,t,e,m,i,r))}return c}function z(s,t,e,n,i,r){const o=r?[]:void 0,c=je(s,t,e,n,{internalQueue:i,deferredActorIds:r},o);return o==null||o.forEach(([a,h])=>{a.retryResolve(e,c,h)}),c}function gt(s,t,e,n=[]){let i=s;const r=[];if(t.type===mt)return i=C(Qt(i,t,e),{status:"stopped"}),r.push(i),{state:i,microstates:r};let o=t;if(o.type!==ve){const a=te(o,i);i=At(a,s,e,o,!1,n),r.push(i)}let c=!0;for(;i.status==="active";){let a=c?Gs(i,o):[];const h=a.length?i:void 0;if(!a.length){if(!n.length)break;o=n.shift(),a=te(o,i)}i=At(a,i,e,o,!1,n),c=i!==h,r.push(i)}return i.status!=="active"&&Qt(i,o,e),{state:i,microstates:r}}function Qt(s,t,e){return z(s,t,e,Object.values(s.children).map(n=>Te(n)),[])}function te(s,t){return t.machine.getTransitionData(t,s)}function Gs(s,t){const e=new Set,n=s._nodes.filter(It);for(const i of n)t:for(const r of[i].concat(Q(i,void 0)))if(r.always){for(const o of r.always)if(o.guard===void 0||Ct(o.guard,s.context,t,s)){e.add(o);break t}}return Pe(Array.from(e),new Set(s._nodes),s.historyValue)}function qs(s,t){const e=it(ot(s,t));return Ie(s,[...e])}function Ks(s){return!!s&&typeof s=="object"&&"machine"in s&&"value"in s}const Xs=function(t){return be(t,this.value)},Ys=function(t){return this.tags.has(t)},Vs=function(t){const e=this.machine.getTransitionData(this,t);return!!(e!=null&&e.length)&&e.some(n=>n.target!==void 0||n.actions.length)},Zs=function(){const{_nodes:t,tags:e,machine:n,getNextEvents:i,getMeta:r,toJSON:o,can:c,hasTag:a,matches:h,...d}=this;return{...d,tags:Array.from(e)}},Fs=function(){return[...new Set(Se([...this._nodes.map(t=>t.ownEvents)]))]},Qs=function(){return this._nodes.reduce((t,e)=>(e.meta!==void 0&&(t[e.id]=e.meta),t),{})};function st(s,t){return{status:s.status,output:s.output,error:s.error,machine:t,context:s.context,_nodes:s._nodes,value:Ie(t.root,s._nodes),tags:new Set(Se(s._nodes.map(e=>e.tags))),children:s.children,historyValue:s.historyValue||{},matches:Xs,hasTag:Ys,can:Vs,getNextEvents:Fs,getMeta:Qs,toJSON:Zs}}function C(s,t={}){return st({...s,...t},s.machine)}function tn(s,t){const{_nodes:e,tags:n,machine:i,children:r,context:o,can:c,hasTag:a,matches:h,getNextEvents:d,getMeta:l,toJSON:u,...f}=s,p={};for(const m in r){const tt=r[m];p[m]={state:tt.getPersistedState(t),src:tt.src,systemId:tt._systemId,syncSnapshot:tt._syncSnapshot}}return{...f,context:De(o),children:p}}function De(s){let t;for(const e in s){const n=s[e];if(n&&typeof n=="object")if("sessionId"in n&&"send"in n&&"ref"in n)t!=null||(t=Array.isArray(s)?s.slice():{...s}),t[e]={xstate$$type:kt,id:n.id};else{const i=De(n);i!==n&&(t!=null||(t=Array.isArray(s)?s.slice():{...s}),t[e]=i)}}return t!=null?t:s}function en(s,t,e,n,{event:i,id:r,delay:o},{internalQueue:c}){const a=t.machine.implementations.delays;if(typeof i=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${i}" }) instead`);const h=typeof i=="function"?i(e,n):i;let d;if(typeof o=="string"){const l=a&&a[o];d=typeof l=="function"?l(e,n):l}else d=typeof o=="function"?o(e,n):o;return typeof d!="number"&&c.push(h),[t,{event:h,id:r,delay:d}]}function sn(s,t){if(typeof t.delay=="number"){s.self.delaySend(t);return}}function nn(s,t){function e(n,i){}return e.type="xstate.raise",e.event=s,e.id=t==null?void 0:t.id,e.delay=t==null?void 0:t.delay,e.resolve=en,e.execute=sn,e}function rn(s,{machine:t,context:e},n,i){const r=(o,c={})=>{const{systemId:a,input:h}=c;if(typeof o=="string"){const d=Tt(t,o);if(!d)throw new Error(`Actor logic '${o}' not implemented in machine '${t.id}'`);const l=Z(d,{id:c.id,parent:s.self,syncSnapshot:c.syncSnapshot,input:typeof h=="function"?h({context:e,event:n,self:s.self}):h,src:o,systemId:a});return i[l.id]=l,l}else return Z(o,{id:c.id,parent:s.self,syncSnapshot:c.syncSnapshot,input:c.input,src:o,systemId:a})};return(o,c)=>{const a=r(o,c);return i[a.id]=a,s.defer(()=>{var h;if(a._processingStatus!==_.Stopped)try{(h=a.start)==null||h.call(a)}catch(d){s.self.send(K(a.id,d));return}}),a}}function on(s,t,e,n,{assignment:i}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const r={},o={context:t.context,event:e.event,spawn:rn(s,t,e.event,r),self:s==null?void 0:s.self,system:s==null?void 0:s.system};let c={};if(typeof i=="function")c=i(o,n);else for(const h of Object.keys(i)){const d=i[h];c[h]=typeof d=="function"?d(o,n):d}const a=Object.assign({},t.context,c);return[C(t,{context:a,children:Object.keys(r).length?{...t.children,...r}:t.children})]}function St(s){function t(e,n){}return t.type="xstate.assign",t.assignment=s,t.resolve=on,t}const ee=new WeakMap;function O(s,t,e){let n=ee.get(s);return n?t in n||(n[t]=e()):(n={[t]:e()},ee.set(s,n)),n[t]}const cn={},B=s=>typeof s=="string"?{type:s}:typeof s=="function"?"resolve"in s?{type:s.type}:{type:s.name}:s;class Rt{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(at),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?Yt(this.config.states,(n,i)=>new Rt(n,{_parent:this,_key:i,_machine:this.machine})):cn,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=$(this.config.entry).slice(),this.exit=$(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=$(t.tags).slice()}_initialize(){this.transitions=Os(this),this.config.always&&(this.always=P(this.config.always).map(t=>w(this,me,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(B),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(B),eventType:null})}:void 0,history:this.history,states:Yt(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(B)})),entry:this.entry.map(B),exit:this.exit.map(B),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return O(this,"invoke",()=>$(this.config.invoke).map((t,e)=>{const{src:n,systemId:i}=t,r=t.id||Zt(this.id,e),o=typeof n=="string"?n:`xstate#${Zt(this.id,e)}`;return{...t,src:o,id:r,systemId:i,toJSON(){const{onDone:c,onError:a,...h}=t;return{...h,type:"xstate.invoke",src:o,id:r}}}}))}get on(){return O(this,"on",()=>[...this.transitions].flatMap(([e,n])=>n.map(i=>[e,i])).reduce((e,[n,i])=>(e[n]=e[n]||[],e[n].push(i),e),{}))}get after(){return O(this,"delayedTransitions",()=>Is(this))}get initial(){return O(this,"initial",()=>Ms(this,this.config.initial))}next(t,e){const n=e.type,i=[];let r;const o=O(this,`candidates-${n}`,()=>Cs(this,n));for(const c of o){const{guard:a}=c,h=t.context;let d=!1;try{d=!a||Ct(a,h,e,t)}catch(l){const u=typeof a=="string"?a:typeof a=="object"?a.type:void 0;throw new Error(`Unable to evaluate guard ${u?`'${u}' `:""}in transition for event '${n}' in state node '${this.id}':
${l.message}`)}if(d){i.push(...c.actions),r=c;break}}return r?[r]:void 0}get events(){return O(this,"events",()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const n of Object.keys(t)){const i=t[n];if(i.states)for(const r of i.events)e.add(`${r}`)}return Array.from(e)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(n=>!(!n.target&&!n.actions.length&&!n.reenter))));return Array.from(t)}}const an="#";class Ut{constructor(t,e){var n,i,r,o,c;this.config=t,this.version=void 0,this.implementations=void 0,this.types=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.__TContext=void 0,this.__TEvent=void 0,this.__TActor=void 0,this.__TAction=void 0,this.__TGuard=void 0,this.__TDelay=void 0,this.__TTag=void 0,this.__TInput=void 0,this.__TOutput=void 0,this.__TResolvedTypesMeta=void 0,this.id=t.id||"(machine)",this.implementations={actors:(n=e==null?void 0:e.actors)!=null?n:{},actions:(i=e==null?void 0:e.actions)!=null?i:{},delays:(r=e==null?void 0:e.delays)!=null?r:{},guards:(o=e==null?void 0:e.guards)!=null?o:{}},this.version=this.config.version,this.types=(c=this.config.types)!=null?c:{},this.transition=this.transition.bind(this),this.getInitialState=this.getInitialState.bind(this),this.restoreState=this.restoreState.bind(this),this.start=this.start.bind(this),this.root=new Rt(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:n,actors:i,delays:r}=this.implementations;return new Ut(this.config,{actions:{...e,...t.actions},guards:{...n,...t.guards},actors:{...i,...t.actors},delays:{...r,...t.delays}})}resolveState(t){const e=qs(this.root,t.value),n=it(ot(this.root,e));return st({_nodes:[...n],context:t.context||{},children:{},status:Ot(n,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,e,n){if(ms(e)&&!t.getNextEvents().some(r=>r===e.type))return C(t,{status:"error",error:e.data});const{state:i}=gt(t,e,n);return i}microstep(t,e,n){return gt(t,e,n).microstates}getTransitionData(t,e){return Mt(this.root,t.value,t,e)||[]}getPreInitialState(t,e,n){const{context:i}=this.config,r=st({context:typeof i!="function"&&i?i:{},_nodes:[this.root],children:{},status:"active"},this);return typeof i=="function"?z(r,e,t,[St(({spawn:c,event:a})=>i({spawn:c,input:a.input}))],n):r}getInitialState(t,e){const n=$e(e),i=[],r=this.getPreInitialState(t,n,i),o=At([{target:[...Me(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],r,t,n,!0,i),{state:c}=gt(o,n,t,i);return c}start(t){Object.values(t.children).forEach(e=>{e.getSnapshot().status==="active"&&e.start()})}getStateNodeById(t){const e=t.split(at),n=e.slice(1),i=ht(e[0])?e[0].slice(an.length):e[0],r=this.idMap.get(i);if(!r)throw new Error(`Child state node '#${i}' does not exist on machine '${this.id}'`);return rt(r,n)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedState(t,e){return tn(t,e)}restoreState(t,e){const n={},i=t.children;Object.keys(i).forEach(a=>{var y;const h=i[a],d=h.state,l=h.src,u=typeof l=="string"?Tt(this,l):l;if(!u)return;const f=(y=u.restoreState)==null?void 0:y.call(u,d,e),p=Z(u,{id:a,parent:e==null?void 0:e.self,syncSnapshot:h.syncSnapshot,state:f,src:l,systemId:h.systemId});n[a]=p});const r=st({...t,children:n,_nodes:Array.from(it(ot(this.root,t.value)))},this);let o=new Set;function c(a,h){if(!o.has(a)){o.add(a);for(let d in a){const l=a[d];if(l&&typeof l=="object"){if("xstate$$type"in l&&l.xstate$$type===kt){a[d]=h[l.id];continue}c(l,h)}}}}return c(r.context,n),r}}function hn(s,t){return new Ut(s,t)}class dn{constructor(t,e,n){(this.host=t).addController(this),this.service=Z(e).start(),this.propKey=n,this.tempObj={}}get state(){return this.service.getSnapshot()}send(t){this.service.send(t)}hostConnected(){this.service.subscribe(t=>{this.propKey in this.host&&(this.host[this.propKey]=t)})}hostDisconnected(){this.service.stop()}}const se={enabled:"enabled",disabled:"disabled"},ln={counter:({context:s})=>s.counter+1,event:({event:s})=>s},un={counter:({context:s})=>s.counter-1,event:({event:s})=>s},fn=({context:s})=>s.counter<10,pn=({context:s})=>s.counter>0,yn=hn({id:"counter",context:{counter:0,event:void 0},initial:"enabled",states:{enabled:{on:{INC:{actions:St(ln),guard:fn},DEC:{actions:St(un),guard:pn},TOGGLE:{target:se.disabled}}},disabled:{on:{TOGGLE:{target:se.enabled}}}}}),gn=Be`:host {
  --_mark-color: rgb(197, 197, 197);
  display: block;
  box-sizing: border-box;
}

:host([hidden]),
[hidden] {
  display: none !important;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

[aria-disabled=true] {
  opacity: 0.5;
  -webkit-user-select: none;
     -moz-user-select: none;
          user-select: none;
  pointer-events: none;
  cursor: default;
}

p {
  font-size: 1.5rem;
  min-width: 4.25rem;
  text-align: center;
  margin: auto;
  padding: 0.8333em;
  background-color: var(--_mark-color);
}

button {
  display: inline-block;
  min-width: 9.375rem;
  font: inherit;
  cursor: pointer;
  white-space: nowrap;
  border: none;
  color: rgb(245, 245, 245);
  background-color: rgb(51, 65, 85);
  padding: 0.75em;
}
button:first-child:not(:only-child) {
  margin-bottom: 1rem;
}

div {
  display: flex;
  align-items: center;
  max-width: 25rem;
  padding: 1em 2em;
  margin: auto;
  background-color: rgb(238, 238, 238);
  border: 0.0625rem solid var(--_mark-color);
  border-bottom: none;
}
div + div {
  border-top: 0.0625rem dashed var(--_mark-color);
  border-bottom: 0.0625rem solid var(--_mark-color);
}

span {
  display: flex;
  flex-direction: column;
  margin-right: 2rem;
}

::slotted(*) {
  white-space: nowrap;
}`;var T,J;class wt extends q{constructor(){super();jt(this,T);this._xstate={},this.counterController=new dn(this,yn,"_xstate")}updated(e){if(super.updated&&super.updated(e),e.has("_xstate")){const{context:n,value:i}=this._xstate,r=new CustomEvent("counterchange",{bubbles:!0,detail:{...n,value:i}});this.dispatchEvent(r)}}render(){return ye`
      <slot></slot>
      <div aria-disabled="${L(this,T,J)}">
        <span>
          <button
            ?disabled="${L(this,T,J)}"
            data-counter="increment"
            @click=${()=>this.counterController.send({type:"INC"})}
          >
            Increment
          </button>
          <button
            ?disabled="${L(this,T,J)}"
            data-counter="decrement"
            @click=${()=>this.counterController.send({type:"DEC"})}
          >
            Decrement
          </button>
        </span>
        <p>${this.counterController.state.context.counter}</p>
      </div>
      <div>
        <button @click=${()=>this.counterController.send({type:"TOGGLE"})}>
          ${L(this,T,J)?"Enabled counter":"Disabled counter"}
        </button>
      </div>
    `}}T=new WeakSet,J=function(){return this.counterController.state.matches("disabled")},dt(wt,"properties",{_xstate:{type:Object,state:!0}}),dt(wt,"styles",[gn]);window.customElements.define("xstate-counter",wt);_e(ye` <xstate-counter @counterchange="${s=>console.log("==>",s.detail)}">
          <h1>
            State machine with
            <a target="_blank" rel="noopener noreferrer" href="https://stately.ai/docs/installation"
              >XState</a
            >
            and
            <a
              href="https://lit.dev/docs/composition/controllers/"
              target="_blank"
              rel="noopener noreferrer"
              >Lit Controller</a
            >
          </h1>
        </xstate-counter>`,document.querySelector("body"));
